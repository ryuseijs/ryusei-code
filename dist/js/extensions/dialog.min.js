!function(t,n){"function"==typeof define&&define.amd?define([],n):"undefined"!=typeof exports?n():(n(),t.unknown={})}("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:this,function(){"use strict";function o(t,n){t.prototype=Object.create(n.prototype),i(t.prototype.constructor=t,n)}function i(t,n){return(i=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t})(t,n)}function r(t,n){for(var i=0;i<n.length;i++){var o=n[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}
/*!
   * RyuseiCode.js
   * Version  : 0.1.3
   * License  : MIT
   * Copyright: 2021 Naotoshi Fujita
   */
var e="ryuseicode",c=e+"__button",u="is-active";function s(t){return null!==t&&"object"==typeof t}function f(t){return Array.isArray(t)}function h(t){return"string"==typeof t}function a(t){return void 0===t}function l(t,n){return void 0===n&&(n=!1),!f(t)||n&&!f(t[0])?[t]:t}function d(n,t,i){n&&l(t).forEach(function(t){t&&n.classList[i?"add":"remove"](t)})}function v(t,n){d(t,n,!0)}function y(t,n){l(n).forEach(t.appendChild.bind(t))}function w(t,n){if(t)for(var i=Object.keys(t),o=0;o<i.length&&!1!==n(t[i[o]],i[o]);o++);return t}function _(o){for(var t=arguments.length,n=new Array(1<t?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return n.forEach(function(i){s(i)&&w(i,function(t,n){a(i[n])||(o[n]=i[n])})}),o}function b(i,t){if(i){if(h(t))return i.getAttribute(t);s(t)&&w(t,function(t,n){null===t?i.removeAttribute(n):i.setAttribute(n,String(t))})}}function p(t,n,i){t=document.createElement(t);return n&&(h(n)||f(n)?v:b)(t,n),i&&y(i,t),t}function g(t,n){return p("div",t,n)}var k=new WeakMap;function m(t,n){return t.querySelector(n)}function x(t){l(t).forEach(function(t){t&&t.parentNode&&t.parentNode.removeChild(t)})}function A(t,n){d(t,n,!1)}function j(t,n){if(t){if(a(n))return t.textContent;t.textContent=n}}function D(t,n){if(void 0===n&&(n=""),!t)throw new Error("["+e+"] "+n)}var E={Up:"ArrowUp",Down:"ArrowDown",Right:"ArrowRight",Left:"ArrowLeft",Del:"Delete",Esc:"Escape",Spacebar:" "};document.createRange.bind(document);var O="0 0 24 24";function B(t,n){t=document.createElementNS("http://www.w3.org/2000/svg",t);return b(t,n),t}var t=function(n){function t(){var t=n.apply(this,arguments)||this;return t.groups={},t}o(t,n);var i=t.prototype;return i.mount=function(t){n.prototype.mount.call(this,t),this.create(),this.listen()},i.create=function(){D(!1)},i.listen=function(){this.bind(window,"keydown",this.escape,this)},i.escape=function(t){var n,i;this.isActive()&&"Escape"===(i=t.key,E[i]||i)&&(this.hide(),(t=t)&&(t.cancelable&&t.preventDefault(),n&&t.stopPropagation()))},i.append=function(t){y(this.wrapper,this.groups[t].elm)},i.autoFocus=function(t){t=this.groups[t].elm,t=m(t,"[tabindex]")||m(t,"input, button");t&&(t.focus(),t instanceof HTMLInputElement&&t.select())},i.createCloseButton=function(t){var n=this.createButtons({id:"close",icon:"close",click:"hide"},null,this).close;return b(n,t),n},i.createButtons=function(t,o,r,e){var u=this,c={};return l(t).forEach(function(n){var t=u.createButton(n,o,e),i=n.click;i&&u.bind(t,"click",function(t){h(i)?r[i]():i(t,u.Editor,n)}),c[n.id]=t},[]),c},i.createButton=function(t,n,i){var o=this.options.i18n,r=t.checkbox,e=t.tabindex,u=t.icon,o=o[t.i18n||t.id];i=[c].concat(u?c+"--icon":null,i);e=p("button",{title:u?o:null,type:"button",tabindex:a(e)?null:e,role:r?"checkbox":null,"aria-checked":r?"false":null,"aria-label":o},n||t.parent);return v(e,i),u?(r=this.options.icons[u])&&y(e,(n=r[0],i=r[1],u=r[2]||"round",r=B("svg",{viewBox:O,class:"ryuseicode__icon"}),n=B("path",{d:n,fill:"currentColor"}),i&&b(n,{"stroke-width":i,"stroke-linecap":u,stroke:"currentColor"}),b(r,{viewBox:O}),r.appendChild(n),r)):function(t,n){if(t){if(a(n))return t.innerHTML;t.innerHTML!==n&&(t.innerHTML=n)}}(e,t.html||o),e},i.createField=function(t,n){var i=this.i18n[t.i18n||t.id],t=t.tabindex;return p("input",{class:"ryuseicode__input",placeholder:i,spellcheck:!1,tabindex:a(t)?null:t,"aria-label":i},n)},i.show=function(t){this.isActive()&&x(this.groups[this.group].elm),v(this.wrapper,u),this.append(t),this.group=t},i.hide=function(){this.isActive()&&(A(this.wrapper,u),x(this.groups[this.group].elm))},i.isActive=function(t){return n=this.wrapper,i=u,n&&n.classList.contains(i)&&(!t||this.group===t);var n,i},i.isFocused=function(){return this.wrapper.contains(document.activeElement)},t}(function(){function t(t){this.Editor=t,this.event=t.event,this.options=t.options,this.language=t.language}var n,i,o=t.prototype;return o.mount=function(t){var i=this;this.elements=t,w(this.Editor.Components,function(t,n){i[n]=t})},o.on=function(t,n,i,o){this.event.on(t,i?n.bind(i):n,this,o)},o.off=function(t){this.event.off(t,this)},o.emit=function(t){for(var n,i=arguments.length,o=new Array(1<i?i-1:0),r=1;r<i;r++)o[r-1]=arguments[r];(n=this.event).emit.apply(n,[t].concat(o))},o.bind=function(t,n,i,o){var r,e,u,c;r=t,e=n,u=o?i.bind(o):i,c=this,e.split(" ").forEach(function(t){r.addEventListener(t,u),c&&((t=k.get(c)||[]).push({elm:r,events:e,callback:u}),k.set(c,t))})},o.getLanguage=function(t){t=t||this.Selection.get().start;var n=this.language,t=this.lines.getInfoAt(t);return t&&t.language&&n.use&&n.use[t.language]?n.use[t.language].config:n},o.destroy=function(){!function n(i,t,o){"function"==typeof o?t.split(" ").forEach(function(t){i.removeEventListener(t,o)}):(t=k.get(o))&&(t.forEach(function(t){n(t.elm,t.events,t.callback)}),k.delete(o))}(null,"",this)},o.invoke=function(t,n){for(var i,o=arguments.length,r=new Array(2<o?o-2:0),e=2;e<o;e++)r[e-2]=arguments[e];return(i=this.Editor).invoke.apply(i,[t,n].concat(r))},o.require=function(t){return this.Editor.require(t)},o.addIcons=function(t){var n=this.options;n.icons=_({},t,n.icons)},o.addI18n=function(t){var n=this.options;n.i18n=_({},t,n.i18n)},o.addKeyBindings=function(t){var n=this.options;n.keymap=_({},t,n.keymap)},o.getOptions=function(t,n){t=this.options[t];return a(t)||!0===t?n||{}:s(t)?_({},n,t):void D(!1)},n=t,(o=[{key:"lines",get:function(){return this.Code.Lines}},{key:"i18n",get:function(){return this.options.i18n}}])&&r(n.prototype,o),i&&r(n,i),t}()),L={confirm:{id:"confirm",click:"confirm"},cancel:{id:"cancel",click:"hide",tabindex:0}},S=e+"__dialog",T=e+"-common";"undefined"!=typeof window&&window.RyuseiCode&&window.RyuseiCode.compose({Dialog:function(n){function t(){return n.apply(this,arguments)||this}o(t,n);var i=t.prototype;return i.mount=function(t){n.prototype.mount.call(this,t),this.register(T,g(),"")},i.listen=function(){var i=this;this.bind(window,"click",function(t){i.wrapper.contains(t.target)||i.hide()}),this.on("initStyle",function(t,n){n("."+S+" code","fontFamily",i.options.monospaceFont)})},i.create=function(){var t=this.elements,n=t.root.id+"-dialog";this.wrapper=g({id:n,class:S,role:"dialog","aria-labelledby":n+"-title","aria-describedby":n+"-body"},t.overlay)},i.confirm=function(){this.emit("dialog:"+this.group+":confirmed",this),this.hide()},i.register=function(t,n,i,o){var r=(o||["confirm"]).map(function(t){return h(t)?L[t]:t}).filter(Boolean);D(r.length);var e=this.wrapper.id,u=g("ryuseicode__dialog__group"),c=p("header","ryuseicode__dialog__header"),s=p("h3",{id:e+"-title",class:"ryuseicode__dialog__title"},c),f=p("footer","ryuseicode__dialog__footer"),o=this.createCloseButton({"aria-controls":e});b(n,{id:e+"-body",class:"ryuseicode__dialog__body"}),j(s,i),v(o,S+"__close"),y(u,[c,n,f,o]),this.groups[t]={elm:u,title:s,body:n,buttons:this.createButtons(r,f,this)}},i.show=function(t){this.hide(),n.prototype.show.call(this,t),this.Editor.readOnly=!0,v(this.elements.overlay,u),this.autoFocus(t),this.emit("dialog:opened",this,t)},i.hide=function(){this.isActive()&&(this.Editor.readOnly=!1,n.prototype.hide.call(this),A(this.elements.overlay,u),this.Selection.reselect(),this.emit("dialog:closed",this,this.group))},i.message=function(t,n){var i=this.groups[T];j(i.title,n||this.i18n.notice),j(i.body,t),this.show(T)},t}(t)})});
