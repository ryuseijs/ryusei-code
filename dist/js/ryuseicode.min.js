function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _inheritsLoose(t,i){t.prototype=Object.create(i.prototype),_setPrototypeOf(t.prototype.constructor=t,i)}function _setPrototypeOf(t,i){return(_setPrototypeOf=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function _defineProperties(t,i){for(var n=0;n<i.length;n++){var s=i[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function _createClass(t,i,n){return i&&_defineProperties(t.prototype,i),n&&_defineProperties(t,n),t}
/*!
 * RyuseiCode.js
 * Version  : 0.1.2
 * License  : MIT
 * Copyright: 2021 Naotoshi Fujita
 */
!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(t="undefined"!=typeof globalThis?globalThis:t||self).RyuseiCode=i()}(this,function(){"use strict";var s={selectAll:["A",!0]},h={default:["Ctrl","Shift","Alt"],mac:["⌘","⇧","⌥"]},r={language:"javascript",placeholder:"Enter code here…",minWidth:"200px",maxWidth:"100%",minHeight:"16em",maxHeight:"40em",indent:"  ",tabSize:2,tabIndex:0,keymap:s,maxInitialLines:200,icons:{arrowUp:["m18.6 10.3c-6.59-6.85-6.59-6.85-6.59-6.85m-6.59 6.85 6.59-6.85m0 17v-17",3],arrowDown:["m5.41 13.7 6.59 6.85m6.59-6.85c-6.59 6.85-6.59 6.85-6.59 6.85m0-17v17",3],close:["m19 18-14-13m0 13 14-13",3]},i18n:{copy:"Copy",cut:"Cut",paste:"Paste",selectAll:"Select All",close:"Close",confirm:"OK",activate:"Activate",notice:"Notice",cancel:"Cancel",failedToCopy:"Can not copy on your environment.",scrollbar:"Drag to Scroll",inputLabel:"Edit the code.",location:"Line: %s, Column: %s"}};function o(t,i){return-1<t.indexOf(i)}function e(t){return null!==t&&"object"==typeof t}function u(t){return Array.isArray(t)}function c(t){return"function"==typeof t}function f(t){return"string"==typeof t}function v(t){return void 0===t}function a(t){return t instanceof Text}function l(t){return t instanceof HTMLElement}function d(t){return t instanceof HTMLBRElement}function p(t,i){return void 0===i&&(i=!1),!u(t)||i&&!u(t[0])?[t]:t}var y=Array.prototype;function g(t,i,n){return y.slice.call(t,i,n)}function w(t,i,n){for(var s,h=arguments.length,r=new Array(3<h?h-3:0),o=3;o<h;o++)r[o-3]=arguments[o];return(s=y.splice).call.apply(s,[t,i,n].concat(r))}function m(){return document.activeElement}function _(i,t,n){i&&p(t).forEach(function(t){t&&i.classList[n?"add":"remove"](t)})}function b(t,i){_(t,i,!0)}function k(t,i){p(i).forEach(t.appendChild.bind(t))}function L(t,i){if(t)for(var n=Object.keys(t),s=0;s<n.length&&!1!==i(t[n[s]],n[s]);s++);return t}function x(s){for(var t=arguments.length,i=new Array(1<t?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];return i.forEach(function(n){e(n)&&L(n,function(t,i){v(n[i])||(s[i]=n[i])})}),s}function A(n,t){if(n){if(f(t))return n.getAttribute(t);e(t)&&L(t,function(t,i){null===t?n.removeAttribute(i):n.setAttribute(i,String(t))})}}function C(t,n){p(t).forEach(function(t){var i;!t||(i=t.parentNode||n&&n.parentNode)&&i.insertBefore(t,n)})}function M(t,i){if(c(t.closest))return t.closest(i);for(;t;){if(n=t,s=i,Element.prototype.matches=Element.prototype.matches||Element.prototype.msMatchesSelector,n.matches(s))return t;t=t.parentElement}var n,s;return null}function T(t,i,n){t=document.createElement(t);return i&&(f(i)||u(i)?b:A)(t,i),n&&k(n,t),t}function E(t,i){return T("div",t,i)}function D(t){c(t.setActive)?t.setActive():t.focus({preventScroll:!0})}function S(t,i){return t&&t.classList.contains(i)}function R(t){return t.clientHeight}function z(t,i){if(t){if(v(i))return t.innerHTML;t.innerHTML!==i&&(t.innerHTML=i)}}function H(t){return t&&t.defaultPrevented}var O=new WeakMap;function P(i,n,s,h){n.split(" ").forEach(function(t){i.addEventListener(t,s),h&&((t=O.get(h)||[]).push({elm:i,events:n,callback:s}),O.set(h,t))})}function B(i,t,n){c(n)?t.split(" ").forEach(function(t){i.removeEventListener(t,n)}):(t=O.get(n))&&(t.forEach(function(t){B(t.elm,t.events,t.callback)}),O.delete(n))}function F(t,i){t&&(t.cancelable&&t.preventDefault(),i&&t.stopPropagation())}function I(t,i){return t.querySelector(i)}function W(t,i){return t.querySelectorAll(i)}function j(t){return t.getBoundingClientRect()}function U(t){p(t).forEach(function(t){t&&t.parentNode&&t.parentNode.removeChild(t)})}function N(t,i){_(t,i,!1)}function X(n,t){if(f(t))return getComputedStyle(n)[t];L(t,function(t,i){v(t)||(n.style[i]=String(t))})}function $(t,i,n){return"<"+(n||"div")+" "+(t=x(i=void 0===i?{}:i,{class:p(t).filter(Boolean).join(" ")}),s="",L(t,function(t,i){i&&(t||!1===t||0===t)&&(s+=" "+i+'="'+t+'"')}),s.trim())+">";var s}function q(t,i){if(t){if(v(i))return t.textContent;t.textContent=i}}function Y(t){return f(t)?t:t+"px"}function Z(){return window.InstallTrigger}function K(){return document.documentMode}function V(){return/android/i.test(navigator.userAgent)||(t=navigator.userAgent,/iPad|iPhone|iPod/.test(t)||-1<t.indexOf("Mac")&&1<navigator.maxTouchPoints);var t}var G="ryuseicode";function J(t,i){if(void 0===i&&(i=""),!t)throw new Error("["+G+"] "+i)}function Q(s,h,r,o,e){var u,c;function t(){o&&a();for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];c=f.bind.apply(f,[this].concat(i)),u||(v(u)&&r?c():u=e?requestAnimationFrame(c):setTimeout(c,h))}function f(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];s.apply(this,i),a()}function a(){(e?cancelAnimationFrame:clearTimeout)(u),u=null}return t.cancel=a,t.invoke=function(){u&&c()},t}function tt(t,i){return Q(t,i,!1,!0)}function it(t){setTimeout(t)}function nt(t,i){return Q(t,0,i,!1,!0)}var st=[].concat(["ArrowDown","ArrowRight"],["ArrowUp","ArrowLeft"]),i={Up:"ArrowUp",Down:"ArrowDown",Right:"ArrowRight",Left:"ArrowLeft",Del:"Delete",Esc:"Escape",Spacebar:" "};function ht(t){return i[t]||t}function rt(t,i,n,s){var h=Math.min(i,n),n=Math.max(i,n);return s?h<t&&t<n:h<=t&&t<=n}var ot=Math.max,et=Math.min;function ut(t,i,n){var s=et(i,n),n=ot(i,n);return et(ot(s,t),n)}var ct=Math.min,ft=Math.max,at=Math.floor,vt=Math.ceil,lt=Math.abs,dt=Math.round;function pt(t,i){return t[0]-i[0]||t[1]-i[1]}var yt=document.createRange.bind(document),gt=window.getSelection;function wt(t,i){var n=t.childNodes;if(!n.length&&!i)return{node:t,offset:0};if(i<=t.textContent.length)for(var s=0;s<n.length;s++){var h=n[s],r=h.textContent.length;if(a(h)){if(i<=r)return{node:h,offset:i}}else if(h instanceof Element){h=wt(h,i);if(h)return h}i-=r}return null}function mt(t,i,n,s){return void 0===s&&(s=t.length),((t=(n=void 0===n?0:n)||s!==t.length?t.slice(n,s):t).match(new RegExp(i,"g"))||[]).length}function _t(t){for(var i=0;i<(arguments.length<=1?0:arguments.length-1);i++)t=t.replace("%s",String(i+1<1||arguments.length<=i+1?void 0:arguments[i+1]));return t}function bt(t,i,n,s){for(var h=(s=void 0===s?0:s)-1,r=n;(-1!==h||n===r)&&r--;)h=t.indexOf(i,h+1);return h}function kt(t,i){if(String.prototype.repeat)return t.repeat(i);for(var n="";0<i;)i%2&&(n+=t),i=at(i/2),t+=t;return n}function Lt(t,i){return t.slice(0,i.length)===i}var xt={};var t=function(){function t(t){this.Editor=t,this.event=t.event,this.options=t.options,this.language=t.language}var i=t.prototype;return i.mount=function(t){var n=this;this.elements=t,L(this.Editor.Components,function(t,i){n[i]=t})},i.on=function(t,i,n,s){this.event.on(t,n?i.bind(n):i,this,s)},i.off=function(t){this.event.off(t,this)},i.emit=function(t){for(var i,n=arguments.length,s=new Array(1<n?n-1:0),h=1;h<n;h++)s[h-1]=arguments[h];(i=this.event).emit.apply(i,[t].concat(s))},i.bind=function(t,i,n,s){P(t,i,s?n.bind(s):n,this)},i.getLanguage=function(t){t=t||this.Selection.get().start;var i=this.language,t=this.lines.getInfoAt(t);return t&&t.language&&i.use&&i.use[t.language]?i.use[t.language].config:i},i.destroy=function(){B(null,"",this)},i.invoke=function(t,i){for(var n,s=arguments.length,h=new Array(2<s?s-2:0),r=2;r<s;r++)h[r-2]=arguments[r];return(n=this.Editor).invoke.apply(n,[t,i].concat(h))},i.require=function(t){return this.Editor.require(t)},i.addIcons=function(t){var i=this.options;i.icons=x({},t,i.icons)},i.addI18n=function(t){var i=this.options;i.i18n=x({},t,i.i18n)},i.addKeyBindings=function(t){var i=this.options;i.keymap=x({},t,i.keymap)},i.getOptions=function(t,i){t=this.options[t];return v(t)||!0===t?i||{}:e(t)?x({},i,t):void J(!1)},_createClass(t,[{key:"lines",get:function(){return this.Code.Lines}},{key:"i18n",get:function(){return this.options.i18n}}]),t}(),At=G,Ct=G+"__body",Mt=G+"__scroller",Tt=G+"__container",Et=G+"__editor",Dt=G+"__scrollbar",St=G+"__lines",Rt=G+"__line",zt=G+"__caret",Ht=G+"__markers",Ot=G+"__marker",Pt=G+"__context-menu",Bt=Pt+"__group",Ft=Pt+"__list",It=Pt+"__button",Wt=G+"__button",jt="is-active",Ut="is-rendered",Nt="is-anchor",Xt="is-focus",$t="is-preserved",qt="is-focused",n="is-dragging",Yt="is-empty",Zt="mounted",Kt="focus",Vt="blur",Gt="readOnly",Jt="keydown",Qt="newline",ti="change",ii="changed",ni="compositionStart",si="focusLineChanged",hi="keymap",ri="chunkMoved",oi="selecting",ei="selected",ui="scrolled",ci="scrollerScroll",fi="windowScroll",ai="resize",vi="scrollWidthChanged",li="scrollHeightChanged",di="contextMenuClicked",pi="reset",yi="initStyle",gi="fontLoaded",wi=function(){function t(t,i,n){var s=this;this.t=t,this.caret=E([zt,zt+"--"+i],n),this.i=tt(this.i.bind(this),30),t.event.on(ai,function(){s.n&&s.move(s.n)})}var i=t.prototype;return i.move=function(t){var i=this.t.Components.Measure.getOffset(t);X(this.caret,{top:Y(i.top),left:Y(i.left+-1),animation:"none"}),this.i(),this.n=t},i.show=function(){b(this.caret,jt)},i.hide=function(){N(this.caret,jt)},i.i=function(){X(this.caret,{animation:""})},t}(),mi="primary",_i=function(i){function t(){var t=i.apply(this,arguments)||this;return t.s={},t}_inheritsLoose(t,i);var n=t.prototype;return n.mount=function(t){i.prototype.mount.call(this,t),this.h(),K()||V()||(this.register(mi),this.r=this.get(mi),this.o())},n.h=function(){this.e=E({class:"ryuseicode__carets",role:"presentation","aria-hidden":!0},this.elements.editor)},n.o=function(){var n=this,t=this.elements.editable,s=this.r,h=this.Editor;this.bind(t,"focus",function(){h.readOnly||s.show()}),this.bind(t,"blur",function(){s.hide()}),this.u=nt(this.u.bind(this)),this.on(Gt,function(t,i){i?s.hide():h.isFocused()&&(n.u(),s.show())}),this.on(ei,this.c,this),this.on(oi,this.u)},n.c=function(t,i){this.Editor.readOnly||i.is(3,1,8)&&this.u()},n.u=function(){this.r.move(this.Selection.get(!1).end)},n.register=function(t){var i=this.s;J(!i[t]);var n=new wi(this.Editor,t,this.e);return i[t]=n},n.get=function(t){return this.s[t=void 0===t?mi:t]},_createClass(t,[{key:"rect",get:function(){return this.Selection.getRect(!0)}}]),t}(t),bi=function(n){function t(){var t=n.apply(this,arguments)||this;return t.start=0,t.margin=10,t.offsetY=0,t.f={},t.a={},t.v=0,t}_inheritsLoose(t,n);var i=t.prototype;return i.mount=function(t){n.prototype.mount.call(this,t);var i=t.scroller;this.l=i,this.p=t.lines,this.v=window.pageYOffset+i.scrollTop,this.y=this.g(),this.w=tt(this.w.bind(this),60),this.m(),this._(),this.o()},i.o=function(){var t=this,i=nt(this.b.bind(this));this.bind(this.l,"scroll",function(){i(!0),t.emit(ci)}),this.bind(window,"scroll",function(){i(!1),t.emit(fi)}),this.bind(window,"scroll",nt(function(){t.y=t.g(),t.k=null})),this.on(ai,function(){t.k=null,t.L()}),this.on(li,function(){t.m(),t.k=null}),this.on(ei,this.c,this,0),this.on(oi,function(){t.x(!0),t.A&&t.C(!0)})},i.c=function(t,i){i.is(1,3)&&(this.x(!0),this.x(!1),this.M&&this.C(!1),this.A&&this.C(!0))},i.b=function(t){var i,n=window.pageYOffset+this.l.scrollTop;this.y&&((i=this.v)<n?this.T():n<i&&this.D(),this.emit("scroll",!0),this.w(t)),this.v=n},i.w=function(t){this.emit(ui,t)},i.x=function(t){var i,n=t?Xt:Nt,s=this.Selection.get(!1)[t?"end":"start"][0],h=this.getBoundary(t),r=this.getLine(s);r||(i=this.getBoundary(!t)).row===s&&(r=i.line),r&&(S(r,n)||(this.S(t),b(r,n),x(h,{line:r,row:s}),this.R(t,!0)))},i.S=function(t){var i=this.getBoundary(t),n=i.line;n&&(S(n,$t)&&!S(n,t?Nt:Xt)?U(n):N(n,t?Xt:Nt),i.line=null,i.row=null)},i.C=function(t){var i=this.getBoundary(t);J(i.line),this.emit(t?si:"anchorLineChanged",i.line,i.row),t?this.A=!1:this.M=!1},i.R=function(t,i){t?this.A=i:this.M=i},i.m=function(){var t=this.Measure,i=t.lineHeight,n=t.scrollerRect,t=ct(n.height,window.innerHeight),n=vt(t/i),t=n+2*this.margin;n!==this.visibleLines&&(0<(t=t-(i=this.elms.length))&&(this.z(this.start+i,t,"beforeend"),this.emit("chunkSupplied",this,t)),this.visibleLines=n)},i._=function(){var t=this.elms,i=this.length;t.length>i&&U(t.slice(i-t.length))},i.z=function(t,i,n){for(var s="",h=0;h<i;h++){var r=this.lines[t+h];s+=$([Rt,r?"":Yt]),s+=r?r.html:"",s+="</div>"}return n&&this.p.insertAdjacentHTML(n,s),s},i.T=function(){var t,i,n=this.H();n>=this.length?this.O():0<n&&(i=this.Measure.lineHeight,this.offsetY+=i*n,this.start<0&&(this.offsetY=ft(this.offsetY+this.start*i,0)),t=this.elms,i=this.z(this.start+t.length,n),t[t.length-1].insertAdjacentHTML("afterend",i),U(this.P(0,n)),this.start+=n,this.B(),this.F(),this.emit(ri,this))},i.D=function(){var t,i,n,s=this.I();s>=this.length?this.O():0<s&&(t=this.Measure.lineHeight,U(this.P(-s)),i=this.elms,n=this.z(this.start-s,s),i[0].insertAdjacentHTML("beforebegin",n),this.start-=s,this.offsetY=ft(this.offsetY-t*s,0),this.B(),this.F(),this.emit(ri,this))},i.H=function(){if(this.end<this.lines.length){var t=this.Measure.lineHeight,i=this.margin,n=j(this.p).top,s=this.border[0];if(n+t*i<s)return at((s-n)/t)}return 0},i.I=function(){if(0<this.start){var t=this.Measure,i=t.lineHeight,n=t.padding.bottom,s=this.margin,h=j(this.p),r=h.top,o=h.bottom,t=this.border,h=t[0],t=t[1];if(h<r)return s+at((r-h)/i);if(t<o-i*s-n)return at((o-n-t)/i)}return 0},i.P=function(t,i){return this.elms.slice(t,i).reduce(function(t,i){var n=S(i,Nt),s=S(i,Xt);return n||s?(b(i,$t),A(i,{"aria-hidden":!0})):t.push(i),t},[])},i.B=function(){var t,i,n,s=this.Selection,h=this.f.line,r=this.a.line,o=s.anchor,e=s.focus,u=this.includes(o[0]),c=this.includes(e[0]),f=u&&S(h,$t),a=c&&S(r,$t);(f||a)&&(t=u?o[0]-this.start:-1,i=c?e[0]-this.start:-1,o=ct(t,i),c=ft(t,i),e=s.isBackward(),s=-1<o?(n=e?r:h,e?h:r):u?h:r,e=this.elms,u=n?e.slice(0,o):e.slice(0,c),o=n?e.slice(o+1,c):[],c=e.slice(c+1),f&&(N(h,$t),A(h,{"aria-hidden":null}),U(e[t])),a&&t!=i&&(N(r,$t),A(r,{"aria-hidden":null}),U(e[i])),C(u,n||s),C(o,s),s=s.nextElementSibling,c.length&&c[0]!==s&&C(c,s))},i.F=function(t){void 0===t&&(t=this.offsetY),this.p.style.top=t+"px"},i.O=function(){this.jump(this.Measure.closest(this.l.scrollTop))},i.L=function(){var t,i;this.Measure.getTop(this.start)!==this.offsetY&&(t=this.a.row,i=this.includes(t),this.O(),i&&this.View.jump(t))},i.g=function(){var t=j(this.l),i=t.top,n=t.bottom,t=window.innerHeight;return rt(i,0,t)||rt(n,0,t)||i<0&&t<n},i.getBoundary=function(t){return t?this.a:this.f},i.addPreservedLine=function(t,i){var n,s=this.p,h=E({class:Rt+" "+(t?Xt:Nt)+" "+$t,"aria-hidden":!0});return this.S(t),z(h,this.lines[i].html),i<this.start?(n=s,p(h).forEach(function(t){n.insertBefore(t,n.firstChild)})):k(s,h),x(this.getBoundary(t),{line:h,row:i}),this.R(t,!0),h},i.sync=function(t,i){void 0===t&&(t=this.elms),void 0===i&&(i=this.start);for(var n=0;n<t.length;n++){var s=this.lines[n+i],h=t[n];s?(z(h,s.html),N(h,Yt)):(q(h,""),b(h,Yt))}},i.syncDiff=function(t,i){var n;lt(i)<10&&(n=t-this.start,t=this.elms,0<i?C(t.slice(-i),t[n].nextElementSibling):i<0&&k(this.p,t.slice(1+n,1+n-i)))},i.refresh=function(){this.T(),this.D()},i.jump=function(t){var i=this.Measure,n=this.length,s=i.padding.top,h=i.lineHeight,h=vt(s/h);this.start=ut(t-h,0,ft(this.lines.length-n+this.margin,0)),this.offsetY=i.getTop(this.start);i=this.P(0);i[0].insertAdjacentHTML("afterend",this.z(this.start,n)),U(i),this.F(),this.B(),this.emit(ri,this)},i.scroll=function(t){this.l.scrollTop=t,this.b(!0)},i.getRow=function(t){t=this.elms.indexOf(t);return-1<t?t+this.start:-1},i.getLine=function(t){return this.elms[t-this.start]},i.includes=function(t){return rt(t,this.start,this.end)},_createClass(t,[{key:"end",get:function(){return this.start+this.length-1}},{key:"length",get:function(){return this.visibleLines+2*this.margin}},{key:"elms",get:function(){return g(W(this.p,"."+Rt+":not(."+$t+")"))}},{key:"border",get:function(){var t,i;return this.k||(i=j(this.l),t=ft(i.top,0),i=ct(i.bottom,window.innerHeight),this.k=[t,i]),this.k}}]),t}(t),ki="\n",Li=function(){function t(){this.length=0}var i=t.prototype;return i.push=function(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];y.push.apply(this,i)},i.splice=function(t,i){for(var n=arguments.length,s=new Array(2<n?n-2:0),h=2;h<n;h++)s[h-2]=arguments[h];w.apply(void 0,[this,t,i].concat(s))},i.clear=function(){w(this,0,this.length)},t}();function xi(t,i){return t&&t[0]===i[0]&&(!i[1]||i[1].test(t[1]))&&(v(i[2])||t[2].state===i[2])}
/*!
   * RyuseiLight.js
   * Version  : 1.1.8
   * License  : MIT
   * Copyright: 2020 Naotoshi Fujita
   */var Ai=function(){function t(t){this.W=0,this.depth=0,this.tokens=[],this.indentDepth=0,this.j=t}var i=t.prototype;return i.init=function(){var t=this.first,t=t&&t[2]||{};this.depth=t.depth||0,this.language=t.language||"",this.split=t.split,this.indentDepth=mt(this.getIndent(),this.j.indent),this.U=void 0,this.N=void 0},i.set=function(t,i){(!i||i>this.W)&&(this.tokens=t,this.W=i||Date.now(),this.init())},i.getIndent=function(){var t=this.first;if(t){if("space"===t[0])return t[1];if("comment"===t[0]){t=this.text.match(new RegExp("^"+this.j.indent+"+"));return t?t[0]:""}}return""},i.getInfo=function(t){t=this.tokens[t];return t&&t[2]},i.getInfoAt=function(t){var i=this.tokens,n=this.tokens.length;if(i.length){if(t===this.text.length)return i[n-1][2];for(var s=0;s<n;s++){var h=i[s][2];if(h.from<=t&&t<h.to)return h}}},i.isEmpty=function(){var t=this.tokens;return 1===t.length&&o(["lb","space"],t[0][0])},_createClass(t,[{key:"html",get:function(){if(!this.U){for(var t="",i=0;i<this.tokens.length;i++){var n=this.tokens[i];if(0===i&&n[1]===ki){t+="<br>";break}t+=n[2].html}this.U=t||"<br>"}return this.U}},{key:"text",get:function(){return v(this.N)&&(this.N=this.tokens.reduce(function(t,i){return"lb"!==i[0]&&(t+=i[1]),t},"")),this.N}},{key:"first",get:function(){return this.tokens[0]}}]),t}(),Ci=function(h){function t(t,i,n){var s=h.call(this)||this;return s.X={},s.$=i,s.q=t,s.j=n,s}_inheritsLoose(t,h);var i=t.prototype;return i.insert=function(t,i){for(i=i||1;0<i--;)this.splice(t,0,new Ai(this.j))},i.delete=function(t,i){this.splice(t,i)},i.sync=function(t,i,n,s,h){(s=void 0===s?"":s)&&(i=s+ki+i,n&&n++);var r,o=this.$.lexer.run(i,n);s&&o.shift();for(var e=0;e<o.length;e++){var u=t+e,c=o[e];this[u]||this.insert(u),this[u]&&(e===o.length-1&&(r=!this.Y(this[u].tokens,c)),this[u].set(c,h))}return r},i.asyncSync=function(t,i,n,s,h,r){var o=this;void 0===h&&(h="");var e=this.X;e[t]&&clearTimeout(e[t]);var u=Date.now();e[t]=setTimeout(function(){o.sync(i,n,s,h,u),r&&r()},10)},i.findMinIndent=function(t,i){for(var n=void 0,s=t;s<=i;s++)var h=this[s].getIndent(),n=v(n)||n.length>h.length?h:n;return n||""},i.getInfoAt=function(t){var i=this[t[0]];return i?i.getInfoAt(t[1]):void 0},i.scanUp=function(t,i,n,s,h){void 0===s&&(s=0);var r=this.getInfoAt(t);if(r)for(var o=t[0],e=h?ft(0,o-h):0,u=o;e<=u;u--)for(var c=this[u].tokens,f=u===o?r.index:c.length-1;0<=f;f--){if(xi(c[f],i)){if(!s)return{row:u,info:this[u].getInfo(f)};s++}n&&xi(c[f],n)&&s--}},i.scanDown=function(t,i,n,s,h){void 0===s&&(s=0);var r=this.getInfoAt(t);if(r)for(var o=t[0],t=this.length,e=h?ct(t,o+h):t,u=o;u<e;u++)for(var c=this[u].tokens,f=u===o?r.index:0;f<c.length;f++){if(xi(c[f],i)){if(!s)return{row:u,info:this[u].getInfo(f)};s++}n&&xi(c[f],n)&&s--}},i.findBlockStart=function(t){var i=this.getInfoAt(t);if(i){if(i.split){var n=t[0]-i.distance,s=this[n];return[n,s.getInfo(s.tokens.length-1).from]}return[t[0],i.from]}},i.findBlockEnd=function(t){var i=this.getInfoAt(t);if(i){if(i.split&&!i.tail)for(var n=t[0]+1;n<this.length;n++){var s=this[n].getInfo(0);if(s&&s.tail)return[n,s.to]}return[t[0],i.to]}},i.syncSize=function(t,i){var n=i-this.length;return 0<n?n<100?this.insert(t,n):this.Z(i):n<0&&this.delete(t,-n),n},i.destroy=function(){L(this.X,clearTimeout)},i.Z=function(t){var i=this.length;if(t<i)this.splice(t,i-t);else if(i<t)for(;t-- >i;)this.push(new Ai(this.j))},i.Y=function(t,n){return t.length===n.length&&t.every(function(t,i){i=n[i];return t[0]===i[0]&&t[1]===i[1]&&t[2].depth===i[2].depth})},t}(Li),Mi=function(i){function t(){var t=i.apply(this,arguments)||this;return t.minStart=1/0,t.maxEnd=0,t}_inheritsLoose(t,i);var n=t.prototype;return n.init=function(t){this.Lines?this.Lines.clear():this.Lines=new Ci(this.event,this.Editor.language,this.options),this.value=t,this.Lines.sync(0,t)},n.before=function(t){var i=this.text;return t<0?"":i.slice(0,t<this.size-1?bt(i,ki,t+1)+1:i.length)},n.after=function(t){var i=this.text;return t<=0?i:i.slice(t<this.size?bt(i,ki,t)+1:i.length)},n.getLine=function(t){return t<this.size?this.sliceLines(t,t):""},n.sliceLines=function(t,i){var n=this.text,i=i<this.size-1?bt(n,ki,i+1)+1:this.text.length;return n.slice(bt(n,ki,t)+1,i)},n.sliceRange=function(t,i){t=this.K(t),i=i?this.K(i):this.text.length;return t<i?this.text.slice(t,i):""},n.replaceLines=function(t,i,n){J(t<=i),this.text=this.before(t-1)+this.normalize(n)+this.after(i+1),this.sizeCache=0},n.replaceRange=function(t,i,n){var s=this.K(t),t=this.K(i),i=this.value;s<=t&&(this.text=i.slice(0,s)+this.normalize(n)+i.slice(t),this.sizeCache=0)},n.replaceLinesBy=function(t,i,r){var n=this.size;J(i<n);var o=i===n-1,n=this.sliceLines(t,i).split(ki,i-t+1);this.replaceLines(t,i,n.reduce(function(t,i,n,s){var h=o&&n===s.length-1?"":ki;return t+r(i,n,s)+h},""))},n.search=function(t,i,n,s){var t=f(t)?t.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&"):t.source,h=[];if(t){var r=new RegExp(n?"\\b"+t+"\\b":t,i?"gi":"g");t:for(var o=0;o<this.Lines.length;o++)for(var e,u=this.Lines[o];e=r.exec(u.text);)if(e[0]||r.lastIndex++,h.push({start:[o,e.index],end:[o,e.index+e[0].length]}),s&&h.length>=s)break t}return h},n.destroy=function(){this.Lines&&this.Lines.destroy(),i.prototype.destroy.call(this)},n.K=function(t){var i=t[0];return J(i<this.size),bt(this.text,ki,i)+1+t[1]},n.normalize=function(t){return t.replace(/\r\n?/g,"\n")},_createClass(t,[{key:"value",get:function(){return this.text},set:function(t){this.text=this.normalize(t),this.sizeCache=0}},{key:"size",get:function(){return this.sizeCache=this.sizeCache||mt(this.text,ki)+1,this.sizeCache}}]),t}(t),Ti="0 0 24 24";function Ei(t,i){t=document.createElementNS("http://www.w3.org/2000/svg",t);return A(t,i),t}var Di=function(i){function t(){var t=i.apply(this,arguments)||this;return t.groups={},t}_inheritsLoose(t,i);var n=t.prototype;return n.mount=function(t){i.prototype.mount.call(this,t),this.create(),this.listen()},n.create=function(){J(!1)},n.listen=function(){this.bind(window,"keydown",this.escape,this)},n.escape=function(t){this.isActive()&&"Escape"===ht(t.key)&&(this.hide(),F(t))},n.append=function(t){k(this.wrapper,this.groups[t].elm)},n.autoFocus=function(t){t=this.groups[t].elm,t=I(t,"[tabindex]")||I(t,"input, button");t&&(t.focus(),t instanceof HTMLInputElement&&t.select())},n.createCloseButton=function(t){var i=this.createButtons({id:"close",icon:"close",click:"hide"},null,this).close;return A(i,t),i},n.createButtons=function(t,s,h,r){var o=this,e={};return p(t).forEach(function(i){var t=o.createButton(i,s,r),n=i.click;n&&o.bind(t,"click",function(t){f(n)?h[n]():n(t,o.Editor,i)}),e[i.id]=t},[]),e},n.createButton=function(t,i,n){var s=this.options.i18n,h=t.checkbox,r=t.tabindex,o=t.icon,s=s[t.i18n||t.id];n=[Wt].concat(o?Wt+"--icon":null,n);r=T("button",{title:o?s:null,type:"button",tabindex:v(r)?null:r,role:h?"checkbox":null,"aria-checked":h?"false":null,"aria-label":s},i||t.parent);return b(r,n),o?(h=this.options.icons[o])&&k(r,(i=h[0],n=h[1],o=h[2]||"round",h=Ei("svg",{viewBox:Ti,class:"ryuseicode__icon"}),i=Ei("path",{d:i,fill:"currentColor"}),n&&A(i,{"stroke-width":n,"stroke-linecap":o,stroke:"currentColor"}),A(h,{viewBox:Ti}),h.appendChild(i),h)):z(r,t.html||s),r},n.createField=function(t,i){var n=this.i18n[t.i18n||t.id],t=t.tabindex;return T("input",{class:"ryuseicode__input",placeholder:n,spellcheck:!1,tabindex:v(t)?null:t,"aria-label":n},i)},n.show=function(t){this.isActive()&&U(this.groups[this.group].elm),b(this.wrapper,jt),this.append(t),this.group=t},n.hide=function(){this.isActive()&&(N(this.wrapper,jt),U(this.groups[this.group].elm))},n.isActive=function(t){return S(this.wrapper,jt)&&(!t||this.group===t)},n.isFocused=function(){return this.wrapper.contains(m())},t}(t),Si="main",Ri=[{id:"copy",shortcut:["C",!0]},{id:"cut",shortcut:["X",!0],disableOnReadOnly:!0},{id:"paste",shortcut:["V",!0],disableOnReadOnly:!0}],zi=[{id:"selectAll",shortcut:["A",!0]}],Hi=function(n){function t(){var t=n.apply(this,arguments)||this;return t.V=-1,t}_inheritsLoose(t,n);var i=t.prototype;return i.listen=function(){var t=this;n.prototype.listen.call(this);var i=this.elements;this.bind(i.editor,"mousedown",this.G,this),this.bind(document,"contextmenu",this.J,this),this.bind(window,"keydown",this.Q,this),this.on([Vt,ci,fi],this.hide,this),this.bind(i.root,"focusin",function(){t.tt(m())||t.wrapper.contains(m())||t.hide()})},i.create=function(){this.wrapper=E({class:Pt,role:"menu"},this.elements.overlay)},i.G=function(t){2===t.button?(this.show(Si),this.it(t.clientX,t.clientY)):this.hide()},i.J=function(t){var i,n=this;if(this.isActive())return F(t);this.tt(t.target)&&((i=this.Selection).is(0)||(this.View.jump(i.focus[0]),requestAnimationFrame(function(){var t=n.Caret.rect;n.show(Si),n.it(t.left,t.bottom)})),F(t,!0))},i.Q=function(t){var i,n;this.isActive()&&(n="ArrowUp"===(i=ht(t.key)),"ArrowDown"!==i&&!n||(this.a(n),F(t)))},i.a=function(t){var i=W(this.wrapper,"."+It),n=i.length;n&&(this.V+=t?-1:1,this.V<0?this.V=n-1:this.V>=n&&(this.V=0),i[this.V].focus())},i.it=function(t,i){var n=this.wrapper,s=this.wrapper.clientWidth,h=this.Measure.scrollerRect,r=document.documentElement;t+s>r.clientWidth-5&&(t-=s),X(n,{top:Y((i=ct(i,R(r)-R(n)-5))-h.top),left:Y(t-h.left)})},i.tt=function(t){return l(t)&&this.elements.editor.contains(t)},i.nt=function(t){var h=this,i=this.groups[t],t=i.lists,n=i.elm;q(n,""),L(t,function(s,t){var i=T("ul",[Ft,Ft+"--"+t],n);s=s.map(function(t){return t.parent=T("li","ryuseicode__context-menu__item",i),t});t=h.createButtons(s,null,h,It);L(t,function(n,t){var i=h.st(s,t);J(i),A(n,{role:"menuitem"}),h.bind(n,"click",function(){h.emit(di,h,t,n),h.hide()}),i.disableOnReadOnly&&(n.disabled=h.Editor.readOnly,h.on(Gt,function(t,i){n.disabled=i})),h.bind(n,"mouseover",function(){n.focus()})}),h.buttons=x({},h.buttons,t)})},i.st=function(t,i){for(var n=0;n<t.length;n++)if(t[n].id===i)return t[n]},i.register=function(t,i,n){var s=this,h=this.groups;h[t]||(h[t]={elm:E([Bt,Bt+"--"+t]),lists:{}}),n.forEach(function(t){var i=s.i18n[t.i18n||t.id],n=t.shortcut?s.Keymap.getShortcut(t.shortcut):"";t.html=t.html||'<span class="ryuseicode__context-menu__button__label">'+i+"</span>"+(n?'<span class="ryuseicode__context-menu__button__shortcut">'+n+"</span>":"")});t=h[t].lists;t[i]=(t[i]||[]).concat(n)},i.show=function(t){this.groups[t]&&(this.nt(t),n.prototype.show.call(this,t),this.V=-1,this.emit("contextMenuOpened"))},i.hide=function(){this.isActive()&&(n.prototype.hide.call(this),this.buttons=null,this.emit("contextMenuClosed"))},t}(Di),Oi=navigator.clipboard,Pi=function(){function t(){}var i=t.prototype;return i.create=function(t){var i=T("textarea",{},document.body),n="-999999px";return X(i,{position:"absolute",top:n,left:n}),i.value=t,D(i),i.setSelectionRange(0,t.length),i},i.execPaste=function(){var t=this.create("");document.execCommand("paste");var i=t.value;return U(t),i},i.execCopy=function(t,i){t=this.create(t);try{document.execCommand("copy")}catch(t){i&&i()}U(t)},i.paste=function(t){Oi?Oi.readText().then(t):t(this.execPaste())},i.copy=function(t,i){var n=this;Oi?Oi.writeText(t).catch(function(){n.execCopy(t,i)}):this.execCopy(t,i)},t}(),Bi=function(i){function t(){var t=i.apply(this,arguments)||this;return t.ht=new Pi,t}_inheritsLoose(t,i);var n=t.prototype;return n.mount=function(t){i.prototype.mount.call(this,t),this.rt(),this.o()},n.o=function(){var i=this,t=this.elements.editable;this.on(Jt,this.Q,this),this.bind(t,"paste",this.ot,this),this.bind(t,"copy cut",function(t){i[t.type]()}),this.bind(t,"dragover drop paste cut",function(t){F(t,!0)}),this.on(di,this.et,this),K()&&this.bind(t,"compositionstart",function(t){i.ut&&F(t,!0)})},n.Q=function(t,i){function n(t){return o(p(t),h)}var s=this.Selection,h=ht(i.key);if(this.ut=!1,this.Keymap.matches(i,"selectAll"))return s.selectAll(),F(i,!0);i.altKey||i.metaKey||i.ctrlKey||s.isMultiline()&&(1===h.length||n(["Process","Enter"])?(this.delete(),this.ut=!0):n(["Delete","Backspace"])&&(this.delete(),F(i)))},n.et=function(t,i,n){var s=this.Selection;"copy"===n||"cut"===n?(this.ct()||s.selectLine(void 0,"copy"===n,!0),this[n]()):"paste"===n?this.ht.paste(this.paste.bind(this)):"selectAll"===n&&s.selectAll()},n.ot=function(t){var i=(t.clipboardData||window.clipboardData).getData("text");i&&this.paste(i),F(t)},n.rt=function(){var t=this.ContextMenu;t.register(Si,"edit",Ri),t.register(Si,"selection",zi)},n.ct=function(){return!this.Selection.isCollapsed()},n.ft=function(){return!this.Editor.readOnly},n.delete=function(){this.ct()&&this.paste("","delete")},n.paste=function(t,i){var n,s,h,r,o,e,u;void 0===i&&(i="paste"),this.ft()&&("paste"===i&&this.emit("paste",t),n=this.Selection,s=this.Code,h=(e=n.get()).start,r=e.end,u=mt(t,ki)+1,u=[e=(o=h[0])+u-1,t.slice(t.lastIndexOf(ki)+1).length+(1<u?0:h[1])],this.emit(ti,i),s.replaceRange(h,r,t),this.Sync.sync(o,e,e),n.set(u),this.emit(ii,i))},n.copy=function(t,i){var n=this,s=this.i18n.failedToCopy;t=v(t)?this.Selection.toString():t,this.emit("copy",t);var h=this.Selection,r=h.get(!1);this.ht.copy(t,function(){n.require("Dialog")?n.invoke("Dialog","message",s):alert(n.i18n.failedToCopy)}),i||h.set(r.start,r.end)},n.cut=function(){this.ct()&&this.ft()&&(this.emit("cut"),this.copy(void 0,!0),this.delete())},n.cutLine=function(){var t,i,n;this.ft()&&(this.emit("cut"),n=[i=(t=this.Selection).get().start[0],0],this.View.jump(i),t.selectLine(i,!1),this.copy(void 0,!0),t.update(n),this.emit(ti),this.Code.replaceLines(i,i,""),this.Sync.sync(i,i),t.set(n),this.emit(ii))},t}(t),Fi="composition",Ii=function(i){function t(){return i.apply(this,arguments)||this}_inheritsLoose(t,i);var n=t.prototype;return n.mount=function(t){i.prototype.mount.call(this,t),this.o()},n.o=function(){var s=this,t=this.elements.editable;this.bind(t,"keydown",this.Q,this),this.bind(t,K()?"textinput":"input",this.at,this),this.bind(t,"compositionstart",this.vt,this),this.bind(t,"compositionupdate",this.lt,this),this.bind(t,"compositionend",this.dt,this),this.on(si,function(t,i,n){s.line=i,s.row=n})},n.vt=function(t){if(this.disabled){var i=this.Editor,n=this.Selection,s=n.get(!1);return gt().removeAllRanges(),i.blur(),void it(function(){i.focus(),n.set(s.start,s.end)})}this.composing=!0,this.set(Fi),this.emit(ni,t),this.emit(ti,Fi)},n.lt=function(t){var i=this;it(function(){i.Selection.update(i.pt()),i.emit("compositionUpdate",t)})},n.dt=function(t){this.composing=!1,this.apply(),this.emit("compositionEnd",t)},n.Q=function(t){var i=ht(t.key),n=t.altKey,s=t.shiftKey;if(this.disabled&&!st.includes(i))return F(t,!0);this.emit(Jt,t),H(t)||(this.info=this.lines.getInfoAt(this.pt()),this.set("input",{key:i}),"Enter"!==i?this.Selection.isCollapsed()&&("Delete"!==i||s||n?"Backspace"!==i||n||this.yt(t):this.gt(t)):this.wt(t))},n.at=function(t){this.emit("input",this,t),this.composing||this.apply()},n.wt=function(t){this.composing||(this.set("newline",{key:"Enter",value:this.before+ki+this.after,position:[this.row+1,0]}),this.emit(Qt,this),this.apply(),F(t))},n.gt=function(t){var i=this.row,n=this.lines;this.col===this.value.length&&i<n.length-1&&(this.apply({type:"deleteNext",key:"Delete",value:this.value+n[i+1].text,endRow:i+1}),F(t))},n.yt=function(t){var i,n=this.row;0===this.col&&0<n&&(i=this.lines[n-1].text,this.apply({type:"removePrev",key:"Backspace",value:i+this.value,startRow:n-1,position:[n-1,i.length]}),F(t))},n.mt=function(t,i){return t+((i=void 0===i?this.row:i)<this.lines.length-1?ki:"")},n._t=function(t){var i=this.bt;return i&&(i.insertion?t=this.before+i.insertion+this.after:v(i.value)||(t=i.value)),this.mt(t)},n.kt=function(t){var i=this.bt;if(i){if(i.position)return i.position;t[1]+=i.offset||0}return t},n.pt=function(){return[this.row,this.col]},n.set=function(t,i){void 0===i&&(i={});var n=this.bt;n&&n.type===t?this.bt=x(n,i):this.bt=x({type:t},i)},n.get=function(){return this.bt},n.apply=function(t){var i,n,s,h;this.bt=t||this.bt,this.bt&&this.line&&(i=this.Selection,s=this.row,n=(h=this.bt).type,t=void 0===(t=h.startRow)?s:t,s=void 0===(h=h.endRow)?s:h,h=this.pt(),n!==Fi&&this.emit(ti,n),this.View.jump(s),this.Code.replaceLines(t,s,this._t(this.value)),this.Sync.sync(t,s),i.set(this.kt(h)),this.emit(ii,n),this.bt=null,this.info=null)},n.insert=function(t,i){void 0===i&&(i=this.col);var n=this.value;this.value=n.slice(0,i)+t+n.slice(i)},n.char=function(t){return void 0===t&&(t=this.col),this.value.charAt(t)},_createClass(t,[{key:"value",get:function(){return q(this.line)||""},set:function(t){q(this.line,t)}},{key:"before",get:function(){return this.value.slice(0,this.col)}},{key:"after",get:function(){return this.value.slice(this.col)}},{key:"length",get:function(){return this.value.length}},{key:"col",get:function(){var t=this.line,i=gt();if(t&&0<i.rangeCount){i=i.getRangeAt(0).cloneRange();return i.setStart(t,0),i.toString().length}return 0}},{key:"disabled",get:function(){return this.Lt},set:function(t){this.Lt=t}}]),t}(t),Wi=function(i){function t(){var t=i.apply(this,arguments)||this;return t.xt=[],t}_inheritsLoose(t,i);var n=t.prototype;return n.mount=function(t){var n=this;i.prototype.mount.call(this,t),this.At=x({},s,this.options.keymap),L(this.At,function(t){var i;t&&(i=n.xt).push.apply(i,p(t,!0).map(function(t){return t[0].toUpperCase()}))}),this.on(Jt,this.Q,this,0)},n.Q=function(t,i){var n;this.Editor.readOnly||!o(this.xt,ht(i.key).toUpperCase())||(n=this.Ct(i))&&this.emit(hi+":"+n,i,n)},n.Ct=function(n){var s=this,h="";return L(this.At,function(t,i){if(s.matches(n,i))return h=i,!1}),h},n.matches=function(t,i){var n,s,i=this.At[i];return i&&(i=i,s=ht((n=t).key).toUpperCase(),i&&p(i,!0).some(function(t){return s===t[0].toUpperCase()&&!t[1]==!n.ctrlKey&&!t[2]==!n.shiftKey&&!t[3]==!n.altKey}))},n.getShortcut=function(t){t=f(t)?this.At[t]:t;if(t){t=u(t[0])?t[0]:t;if(t){var n=h[/Mac/i.test(navigator.platform)?"mac":"default"];return t.slice(1).map(function(t,i){return t&&n[i]}).filter(Boolean).concat(t[0]).join("+")}}return""},t}(t),ji=function(){function t(t){this.Mt={},this.Tt=T("canvas").getContext("2d"),this.Tt.font=t}var i=t.prototype;return i.Et=function(t,i){var n=this.Mt,s=this.Tt;return(i=void 0===i?!0:i)&&n[t]||(n[t]=K()?s.measureText(kt(t,10)).width/10:s.measureText(t).width)},i.measure=function(t,i){void 0===i&&(i=!0);for(var n=0,s=0;s<t.length;s++)n+=this.Et(t.charAt(s),i);return n},i.clear=function(){this.Mt={}},t}(),Ui=function(i){function t(t){t=i.call(this,t)||this;return t.Dt={},t.on("mount",t.St,_assertThisInitialized(t),0),t}_inheritsLoose(t,i);var n=t.prototype;return n.St=function(t,i){this.elements=i,this.Rt(),this.zt(),this.o()},n.o=function(){var t=this;this.on(ai,function(){t.Ht=0,t.zt(),t.Rt(),t.Ot()},1),this.on(gi,function(){t.Pt.clear()},1),this.on([li,ui,fi],this.Ot,this,1)},n.zt=function(){var t=this.elements.editor,i=E(Rt,t);this.padding={top:parseFloat(X(t,"paddingTop"))||0,bottom:parseFloat(X(t,"paddingBottom"))||0,left:parseFloat(X(i,"paddingLeft"))||0,right:parseFloat(X(i,"paddingRight"))||0},U(i)},n.Rt=function(){var t=this.Bt();this.Ft!==t&&(this.Pt=new ji(t),this.Ft=t)},n.Bt=function(){var t=this.elements.lines;return X(t,"fontSize")+" "+X(t,"fontFamily")},n.Ot=function(){this.Dt={}},n.getTop=function(t){return ut(t,0,this.lines.length-1)*this.lineHeight},n.getBottom=function(t){var i=t>=this.Code.size-1;return this.getTop(t+1)+(i?this.lineHeight:0)},n.closest=function(t){return ut(dt((t-this.padding.top)/this.lineHeight),0,this.lines.length-1)},n.measureWidth=function(t,i){return this.Pt.measure(t,i=void 0===i?!0:i)},n.getOffset=function(t){var i=this.padding,n=t[0]===this.Selection.focus[0]?this.Input.value:this.Code.getLine(t[0]);return{top:this.getTop(t[0])+i.top,left:this.measureWidth(n.slice(0,t[1]))+i.left}},_createClass(t,[{key:"editorRect",get:function(){return this.Dt.editor=this.Dt.editor||j(this.elements.editor)}},{key:"scrollerRect",get:function(){return this.Dt.scroller=this.Dt.scroller||j(this.elements.scroller)}},{key:"containerRect",get:function(){return this.Dt.container=this.Dt.container||j(this.elements.container)}},{key:"lineHeight",get:function(){return this.Ht=this.Ht||parseFloat(X(this.elements.editor,"lineHeight"))}}]),t}(t),Ni=function(){function t(t,i){this.Editor=t,this.elements=i,this.scroller=i.scroller}var i=t.prototype;return i.calcBoundaries=function(t,i){var n=this.Editor.Components.Measure,s=0<pt(t,i);return{start:n.getOffset(s?i:t),end:n.getOffset(s?t:i)}},i.html=function(t,i,n){if((n=void 0===n?!0:n)&&this.cache)return this.cache;var s=this.Editor.Components.Measure,h=s.lineHeight,r=s.padding,o=this.calcBoundaries(t,i),n=o.start,s=o.end,t=s.top-n.top,i=t-h,o=ft(n.left,r.left),e="";return t?(e+=this.buildLine(n.top,o,"100%"),e+=this.buildLine(s.top,r.left,ft(s.left-r.left,0)),0<i&&(e+=this.buildLine(n.top+h,r.left,"100%",i))):e+=this.buildLine(n.top,o,ft(s.left-o,0)),this.cache=e},i.buildLine=function(t,i,n,s){n="top: "+Y(t)+"; left: "+Y(i)+"; width: "+Y(n)+";";return s&&(n+=" height: "+Y(s)+";"),'<div class="'+Ot+'" style="'+n+'"></div>'},t}(),Xi=function(s){function t(t,i,n){t=s.call(this,t,i)||this;return t.e=E([Ht].concat(n),i.background),t}_inheritsLoose(t,s);var i=t.prototype;return i.draw=function(t,i){z(this.e,this.html(t,i,!1))},i.clear=function(){z(this.e,"")},i.isInside=function(t,i){for(var n=this.e.children,s=0;s<n.length;s++){var h=j(n[s]);if(h.width&&rt(t,h.left,h.right)&&rt(i,h.top,h.bottom))return!0}return!1},i.destroy=function(){U(this.e)},t}(Ni),$i=Ht+"--selection",qi=function(n){function t(t,i){i=n.call(this,t,i,$i)||this;return i.listen(),i}_inheritsLoose(t,n);var i=t.prototype;return i.listen=function(){var t=this,i=this.Editor.event;i.on(ei,this.It.bind(this),this,0),i.on(oi,nt(this.Wt.bind(this))),i.on(ai,function(){t.clear(),t.Wt()})},i.It=function(t,i,n,s){i.is(1,3)&&this.clear(),i.is(3,8)&&10!==s&&this.Wt()},i.Wt=function(){var t=this.Editor.Components.Selection;t.isCollapsed()?this.clear():(t=t.get(!1),this.draw(t.start,t.end))},t}(Xi),Yi=function(i){function t(){var t=i.apply(this,arguments)||this;return t.ranges={},t.groups={},t}_inheritsLoose(t,i);var n=t.prototype;return n.mount=function(t){i.prototype.mount.call(this,t),this.selection=new qi(this.Editor,t);t=this.jt.bind(this,!1);this.on(ri,Q(t,200)),this.on(ui,t),this.on([gi,ai],this.jt.bind(this,!0))},n.jt=function(n){var s=this;this.Editor&&L(this.ranges,function(t,i){s.groups[i]&&s.Ut(i,n)})},n.Ut=function(t,n){var s=this,i=this.ranges[t],h="";i.forEach(function(t){var i=t.range;s.g(i)&&(h+=t.marker.html(i.start,i.end,!n))}),this.groups[t].innerHTML=h},n.g=function(t){var i=this.Chunk,n=t.start[0],t=t.end[0];return i.includes(n)||i.includes(t)||rt(i.start,n,t)},n.register=function(t,i,n,s){void 0===n&&(n=!0),void 0===s&&(s=Ni);var h,r=this.ranges;r[t]=r[t]||[],i=i.slice(0,1e4);for(var o=0;o<i.length;o++){var e=i[o];n&&h&&0===pt(h.end,e.start)?h.end=e.end:(h={start:e.start,end:e.end},r[t].push({range:h,marker:new s(this.Editor,this.elements)}))}this.groups[t]||(this.groups[t]=E([Ht,Ht+"--"+t],this.elements.background)),this.jt()},n.clear=function(t){var n=this;t?this.ranges[t]&&(q(this.groups[t],""),this.clearRanges(t)):L(this.ranges,function(t,i){n.clear(i)})},n.clearRanges=function(t){this.ranges[t]=[]},t}(t),Zi=function(t){function i(){return t.apply(this,arguments)||this}_inheritsLoose(i,t);var n=i.prototype;return n.isIn=function(t,i){var n=(t=p(t)).filter(function(t){return-1<t.indexOf("#")}),t=t.filter(function(t){return-1===t.indexOf("#")});return this.inState(n,i)&&this.inCategory(t,i)},n.inState=function(t,i){return this.Nt(t,!1,i)},n.inCategory=function(t,i){return this.Nt(t,!0,i)},n.Nt=function(t,n,s){var h=this,i=(t=p(t)).filter(function(t){return Lt(t,"!")}).map(function(t){return t.slice(1)});return(!i.length||!this.Nt(i,n))&&(!(t=t.filter(function(t){return!Lt(t,"!")})).length||t.some(function(t){var i=h.lines.getInfoAt(s||h.Selection.get().start);return i&&i[n?"category":"state"]===t}))},i}(t);function Ki(t,i){t.contentEditable=i?"true":"false"}var Vi=[0,0],Gi=function(){function t(){this.handlers={}}var i=t.prototype;return i.on=function(t,s,h,r){var o=this;void 0===r&&(r=10),p(t).filter(Boolean).join(" ").split(" ").forEach(function(t){var i=t.split("."),n=i[0],t=i[1],i=o.handlers[n]||[];i.push({event:n,callback:s,namespace:t,priority:r,key:h}),i.sort(function(t,i){return t.priority-i.priority}),o.handlers[n]=i})},i.off=function(t,s){var h=this;p(t).filter(Boolean).join(" ").split(" ").forEach(function(t){var i=t.split("."),t=i[0],n=i[1],i=h.handlers[t];i&&(h.handlers[t]=s||n?i.filter(function(t){return!(t.key===s&&t.namespace===n)}):[])})},i.emit=function(t){for(var i=arguments.length,n=new Array(1<i?i-1:0),s=1;s<i;s++)n[s-1]=arguments[s];var h=this.handlers[t],r={type:t};h&&h.forEach(function(t){t.callback.apply(t,[r].concat(n))})},i.destroy=function(){this.handlers={}},t}(),Ji=function(n){function t(t){var i=n.call(this,0)||this;return i.Xt={},i.t=t,i.$t=t.elements,i.qt=t.Components.Selection,i.o(),i}_inheritsLoose(t,n);var i=t.prototype;return i.o=function(){var t=this.$t.editable,i=this.t.event,n=this.Xt,s=this.Q.bind(this);P(document,"selectionchange",this.Yt.bind(this),n),P(window,"pointerup",this.Zt.bind(this),n),P(t,"pointerdown",this.Kt.bind(this),n),P(t,"keydown",s,n),P(t,"keyup",this.Vt.bind(this),n),i.on(Kt,this.Gt.bind(this)),i.on(Vt,this.Jt.bind(this))},i.Gt=function(){this.is(0)&&this.set(1)},i.Jt=function(){this.t.Components&&(this.Qt()||this.set(0))},i.Yt=function(){m()===this.t.elements.editable&&(this.is(2,6)?this.set(3):this.is(3)?this.set(5):this.is(1,8)&&(gt().isCollapsed?(this.set(3),this.set(1)):(this.set(5),this.set(8))))},i.Kt=function(t){var i;H(t)||(this.device=t instanceof PointerEvent?"pointer":"keyboard",i=this.qt,t instanceof PointerEvent&&2===t.button&&i.isInside(t.clientX,t.clientY)?this.set(10):this.set(t.shiftKey?6:2))},i.Zt=function(){this.device&&!this.is(0)&&(this.device=null,this.is(10)||(this.is(6)?this.set(8):(this.set(7),this.set(gt().isCollapsed?1:8))))},i.Q=function(t){o(st,ht(t.key))&&this.Kt(t)},i.Vt=function(t){o(st,ht(t.key))&&this.Zt()},i.Qt=function(){return this.$t.editor.contains(m())||this.t.Components.ContextMenu.isFocused()},i.update=function(t){this.is(2,6)||(this.set(4),this.set(t?1:8))},i.refresh=function(t){this.is(2,6)||(this.set(2),this.set(3),this.set(t?1:8))},i.destroy=function(){this.event.destroy(),B(null,"",this.Xt)},t}(function(){function t(t){this.event=new Gi,this.bt=t}var i=t.prototype;return i.set=function(t){this.bt===t||this.ti||(this.ii=this.bt,this.bt=t,this.event.emit("changed",t,this.ii))},i.is=function(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return o(g(i),this.bt)},i.isPrev=function(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return o(g(i),this.ii)},i.hold=function(){this.ti=!0},i.release=function(){this.ti=!1},i.on=function(t,i,n){this.event.on(t,i,this,n)},t}()),Qi=function(i){function t(){var t=i.apply(this,arguments)||this;return t.anchor=Vi,t.focus=Vi,t}_inheritsLoose(t,i);var n=t.prototype;return n.mount=function(t){i.prototype.mount.call(this,t),this.state=new Ji(this.Editor),this.o()},n.o=function(){var t=this.elements.editable;this.bind(document,"selectionchange",this.Yt,this),K()?this.bind(t,"dblclick",this.ni,this):this.bind(t,"mousedown",this.G,this),this.state.on("changed",this.It.bind(this)),this.on([ci,fi],this.b,this),this.on(ui,this.si,this)},n.Yt=function(){var t;this.isFocused()&&(!this.is(5,6)||(t=this.hi(!0))&&(this.focus=t,this.emit(oi)),this.emit("selectionChanged"))},n.G=function(t){1<t.detail&&(this.ni(),F(t))},n.ni=function(){var t,i,n=this.ri(this.anchor);n?this.set(n.start,n.end):(i=this.oi(!1))&&(t=i.node,n=gt(),(i=yt()).selectNode(t),n.removeAllRanges(),n.addRange(i),n=this.hi(),i=this.hi(!0),n&&i&&this.set(n,i))},n.It=function(t,i,n){if(4!==n&&10!==n&&(1!==i&&3!==i&&8!==i||(this.anchor=this.hi()||this.anchor,this.focus=this.hi(!0)||this.focus),2!==n&&8===i&&this.ei())){var s=this.lines,h=this.lines.length,s=s[h-1].text.length;if(0!==pt(this.anchor,[0,0])||0!==pt(this.focus,[h-1,s]))return void this.selectAll()}this.emit(ei,this,i,n),5===i&&this.emit(oi)},n.b=function(){var t=this.Input,i=window.pageYOffset+this.elements.scroller.scrollTop;this.isMultiline()&&!t.disabled&&i!==this.v&&(this.Input.disabled=!0,this.v=i)},n.set=function(t,i){this.ui(t,i)||this.update(t,i)},n.get=function(t){void 0===t&&(t=!0);var i=this.anchor,n=this.focus,s=this.isBackward();return{start:s&&t?n:i,end:s&&t?i:n}},n.update=function(t,i,n){this.anchor=t,this.focus=i||t,n||this.state.update(this.isCollapsed())},n.selectLine=function(t,i,n){void 0===t&&(t=this.focus[0]),void 0===i&&(i=!0);var s,h=this.lines,r=h[t];r&&(s=[t,0],t=t<h.length-1?[t+1,0]:[t,r.text.length],r=n?t:s,t=n?s:t,i?this.set(r,t):this.update(r,t,!0))},n.reselect=function(){this.set(this.anchor,this.focus)},n.selectAll=function(){var t=this.lines,i=t.length-1;this.set([0,0],[i,t[i].text.length])},n.hold=function(){this.state.hold()},n.release=function(){this.state.release()},n.toString=function(){var t=this.get();return this.Code.sliceRange(t.start,t.end)},n.getRect=function(t){t=this.oi(t);if(t){for(var i=t.node,n=t.offset;l(i);)if(n=0,d(i=i.firstChild))return j(i);if(i){t=yt();return t.setStart(i,n),t.collapse(!0),j(t)}}return null},n.getLocation=function(){var t=this.focus;return _t(this.i18n.location,t[0]+1,t[1]+1)},n.is=function(){var t;return(t=this.state).is.apply(t,arguments)},n.collapse=function(t){this.set(t?this.focus:this.anchor)},n.isBackward=function(){return 0<pt(this.anchor,this.focus)},n.isCollapsed=function(){return 0===pt(this.anchor,this.focus)},n.isMultiline=function(){return this.anchor[0]!==this.focus[0]},n.isFocused=function(){return this.Editor&&this.Editor.isFocused()},n.isInside=function(t,i){return this.Range.selection.isInside(t,i)},n.destroy=function(){this.state.destroy(),i.prototype.destroy.call(this)},n.ui=function(t,i){var n=this.Chunk,s=t[0]===(i=void 0===i?t:i)[0],h=n.getLine(t[0])||n.addPreservedLine(!1,t[0]),s=s?h:n.getLine(i[0])||n.addPreservedLine(!0,i[0]),n=0===pt(t,i),h=wt(h,t[1]),t=n?h:wt(s,i[1]);return h&&t&&(s=h.node,i=t.node,h.node=d(s)?s.parentNode:s,t.node=d(i)?i.parentNode:i,this.hold(),s=t,(i=h)&&s&&((t=gt()).setBaseAndExtent?t.setBaseAndExtent(i.node,i.offset,s.node,s.offset):((h=0<t.rangeCount?t.getRangeAt(0):document.createRange()).setStart(i.node,i.offset),h.setEnd(s.node,s.offset),t.removeAllRanges(),t.addRange(h))),this.release(),this.state.refresh(n)),!0},n.hi=function(t){var i=this.ci(t),n=this.oi(t);if(i&&n){var s=this.Chunk,h=yt();h.setStart(i,0),h.setEnd(n.node,n.offset);t=s.getRow(i);if(t<0&&(n=s.getBoundary(!1),s=s.getBoundary(!0),n.line===i?t=n.row:s.line===i&&(t=s.row)),-1<t)return[t,h.toString().length]}return null},n.ci=function(t){t=this.oi(t);if(t){t=t.node,t=a(t)?t.parentNode:t;if(l(t))return M(t,"."+Rt)}return null},n.ri=function(t){var i=t[0],n=t[1],t=this.lines[i];if(t)for(var s=t.text.split(/[^\w]/),h=0,r=0;r<s.length;r++){var o=0<r?h+1:0,e=o+s[r].length;if(o<=n&&n<e)return{start:[i,o],end:[i,e]};h=e}return null},n.oi=function(t){var i=this.elements.editable,n=gt(),s=t?"focus":"anchor",t=n[s+"Node"],s=n[s+"Offset"];return t===i&&(t=i.children[s],s=0),t?{node:t,offset:s}:null},n.ei=function(){var t=this.elements.lines,i=this.ci(!1),n=this.ci(!0),t=g(t.children).filter(function(t){return!S(t,Yt)});return i===t[0]&&n===t[t.length-1]&&pt(this.anchor,this.focus)&&0===this.anchor[1]&&this.focus[1]===n.textContent.length},n.si=function(){var t,i,n,s,h,r,o=this,e=this.Input,u=this.elements.editable,c=gt();!V()&&this.isMultiline()&&m()===u&&c.setBaseAndExtent?(t=this.elements.editable,i=c.anchorOffset,n=c.focusOffset,s=c.anchorNode,h=c.focusNode,A(t,{"aria-hidden":!0}),this.hold(),c.removeAllRanges(),Z()?(r=s.cloneNode(!0),u=h.cloneNode(!0),s.parentNode.replaceChild(r,s),h.parentNode.replaceChild(u,h),s=r,h=u):Ki(t,!1),setTimeout(function(){c.setBaseAndExtent(s,i,h,n),it(function(){o.Editor.focus(),e.disabled=!1,Ki(t,!0),A(t,{"aria-hidden":null}),o.release()})},5)):e.disabled=!1},t}(t),tn=function(){function t(t){this.W=Date.now(),this.t=t,this.fi=this.t.Components.Measure,this.ai=this.fi.measureWidth("    "),this.jt()}return t.prototype.jt=function(){this.fi.measureWidth("    ",!1)!==this.ai?this.t.event.emit(gi):Date.now()-this.W<5e3&&requestAnimationFrame(this.jt.bind(this))},t}(),nn=function(i){function t(t){var n=i.call(this,t)||this;return n.vi={},n.li(),n.on("body:open",function(t,i){n.emit(yi,n.add.bind(_assertThisInitialized(n))),i('<style id="'+n.options.id+'-style">'+n.nt()+"</style>")}),n}_inheritsLoose(t,i);var n=t.prototype;return n.li=function(){var n=this,s=this.options,t=this.options.lineHeight;["width","height","minWidth","minHeight","maxWidth","maxHeight"].forEach(function(t){var i=s[t];i&&n.add("root",t,Y(i))});var i=t?t+"em":void 0;this.add("root",Z()?"-moz-tab-size":"tabSize",s.tabSize),this.add("."+Et,{lineHeight:t,fontFamily:s.monospaceFont}),this.add("."+Ot,"minHeight",i),this.add("."+zt,"height",i),K()||this.add("."+Rt+":not(."+Yt+"):not(."+$t+")","height",i)},n.nt=function(){var s="";return L(this.vi,function(t,i){var n="";L(t,function(t,i){v(t)||(n+=i.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()+": "+t+";")}),n&&(s+=i+"{"+n+"}")}),s},n.mount=function(t){this.di=I(t.root,"style"),k(I(document,"head"),this.di),this.options.monospaceFont&&new tn(this.Editor)},n.add=function(n,t,i){var s,h=this;f(t)?v(i)||((s=this.vi)[n="#"+this.options.id+("root"===n?"":" "+n)]=s[n]||{},s[n][t]=i):L(t,function(t,i){h.add(n,i,t)})},n.apply=function(){q(this.di,this.nt())},n.destroy=function(){i.prototype.destroy.call(this),U(this.di)},t}(t),Li=function(i){function t(){var t=i.apply(this,arguments)||this;return t.pi=1/0,t.yi=0,t}_inheritsLoose(t,i);var n=t.prototype;return n.sync=function(t,i,n){var s=this.Chunk,h=this.View,r=this.lines.syncSize(t,this.Code.size);h.autoHeight(),h.autoWidth(),v(n)||h.jump(n),s.includes(t)?this.gi(t,s.end-t+1):(h=s.start,n=s.end,this.gi(h,n-h+1,!1),this.wi(t,i)),s.syncDiff(t,r),s.sync()},n.gi=function(t,i,n){void 0===n&&(n=!0);var s=this.Ct(t,100),h=s.startRow;i=t-(h=!n&&100<t-h?t-100:h)+i,!this.lines.sync(h,this.Code.after(h),i,s.before)&&!this.mi||(h+=i)<(i=this.Code.size)&&this.wi(h,i-1)},n.wi=function(t,i){var n=this;this.pi=ct(t,this.pi),this.yi=ft(i,this.yi),this.mi=!0;i=this._i(this.pi,this.yi);this.bi(i,function(){n.pi=1/0,n.yi=0,n.mi=!1,n.Chunk.sync()})},n.bi=function(t,i){var n=this,s=t.shift(),h=this.Ct(s[0],100),r=h.startRow,h=h.before,s=s[1]-r+1;this.lines.asyncSync("syncRanges",r,this.Code.after(r),s,h,function(){t.length?(n.bi(t,i),n.emit("synced",n,!1)):(i&&i(),n.emit("synced",n,!0))})},n._i=function(t,i){for(var n=[];t<=i;)n.push([t,ct(t+3e3-1,i)]),t+=3e3;return n},n.Ct=function(t,i){if(this.ki(t))return this.Li(t,i);var n=this.xi(t);return i<t-n?this.ki(t-i)?this.Li(t-i,i/2):this.Ai(n,t,"",i):{startRow:n,before:""}},n.Ai=function(t,i,n,s){if(s<i-t){var h=this.lines.findBlockStart([i-1,0]);if(h){var r=this.getLanguage(h).multiline,o=this.lines.getInfoAt(h);if(o&&r)for(var e=0;e<r.length;e++){var u=r[e];if(o.category===u[2]&&(!u[3]||o.state===u[3])){t=h[0]+1,n+=u[0];break}}}}return{startRow:t,before:n}},n.xi=function(t,i){void 0===i&&(i=0);var n=this.lines;if(rt(t,0,n.length,!0))for(var s=t-1;0<=s;s--){var h=n[s];if(h.depth<=i&&h.tokens.length&&!h.isEmpty()){if(!h.split)return s;s-=h.first[2].distance+1}}return 0},n.Li=function(t,i){var n=this.lines,s=n[t].language,h=this.language.use[s],r=this.xi(t,h.depth);return n[r].language===s?this.Ai(r,t,h.code,i):{startRow:r,before:""}},n.ki=function(t){t=this.lines[t];if(t){t=t.language;return t&&this.language.language.id!==t}},t}(t),sn="pointerdown",hn="pointerup",rn="pointermove",on={vertical:"horizontal",scrollHeight:"scrollWidth",clientHeight:"clientWidth",scrollTop:"scrollLeft",minHeight:"minWidth",maxHeight:"maxWidth",height:"width",top:"left",pageY:"pageX",translateY:"translateX"},en=function(t){function i(){return t.apply(this,arguments)||this}return _inheritsLoose(i,t),i.prototype.listen=function(){this.Editor.event.on([Zt,ai,"scroll",li,vi],nt(this.update))},i}(function(r){function t(t,i,n,s,h){return void 0===h&&(h=[0,0]),(s=r.call(this,[Dt,Dt+"--"+(s?"vertical":"horizontal")],i,s)||this).Ci=1,s.Editor=t,s.scroller=n,s.Mi=u(h)?function(){return h}:h,s.li(),s.listen(),s}_inheritsLoose(t,r);var i=t.prototype;return i.li=function(){var t=this.Editor,i=this.scroller;A(this.elm,{role:"scrollbar","aria-controls":i.id,"aria-orientation":this.names.vertical,"aria-valuenow":0,"aria-label":t.options.i18n.scrollbar}),this.update=this.update.bind(this)},i.listen=function(){var t=nt(this.update);P(this.scroller,"scroll",t,this),this.Editor.event.on([Zt,ai],t)},i.onDragging=function(t){r.prototype.onDragging.call(this,t);var i=this.getCoord(t),t=i-this.lastCoord;this.scroller[this.names.scrollTop]+=t/this.Ci,this.lastCoord=i},i.update=function(){var t=this.scroller,i=this.names,n=this.elm,s=n.style,h=t[i.scrollHeight],r=t[i.clientHeight],o=t[i.scrollTop],e=r<h,u=this.Mi(),c=1-(u[0]+u[1])/r,t=r*r/h*c;this.Ti!==t&&(s[i.height]=Y(t),this.Ti=t),e&&(c=(r*c-n[i.clientHeight])/(h-r),s.transform=i.translateY+"("+Y(o*c+u[0])+")",A(n,{"aria-valuenow":dt(1e4*o/(h-r))/100}),this.Ci=c),_(n,jt,e)},i.destroy=function(){B(null,"",this),r.prototype.destroy.call(this)},t}(function(){function t(t,i,n){var s=this;this.names={},this.elm=E(t,i),this.parent=i,this.vertical=n,L(on,function(t,i){s.names[i]=n?i:t}),this.bind()}var i=t.prototype;return i.bind=function(){this.onDrag=this.onDrag.bind(this),this.onDragging=this.onDragging.bind(this),this.onDragged=this.onDragged.bind(this),P(this.elm,sn,this.onDrag)},i.onDrag=function(t){P(window,hn,this.onDragged),P(window,rn,this.onDragging),this.startCoord=this.getCoord(t),this.lastCoord=this.startCoord,this.toggleClass(!0),F(t)},i.onDragging=function(t){F(t)},i.onDragged=function(){B(window,hn,this.onDragged),B(window,rn,this.onDragging),this.toggleClass(!1)},i.getCoord=function(t){return t[this.names.pageY]},i.toggleClass=function(t){_(this.elm,n,t),_(this.parent,[n,n+"--"+this.names.vertical],t)},i.destroy=function(){B(this.elm,sn,this.onDrag),B(window,hn,this.onDragged),B(window,rn,this.onDragging)},t}())),Xi=function(i){function t(){var t=i.apply(this,arguments)||this;return t.Ei=0,t.Di=[],t}_inheritsLoose(t,i);var n=t.prototype;return n.mount=function(t){i.prototype.mount.call(this,t),this.emitResize=nt(this.emit.bind(this,"resize")),t.scroller.scrollTop=0,this.h(),this.autoHeight(),this.o()},n.o=function(){this.bind(window,"resize",this.emitResize),this.on([Zt,ai,ui],this.autoWidth,this),this.on(ai,this.autoHeight.bind(this,!0),null,2),this.on(ei,this.c,this),this.on(oi,this.Si,this)},n.c=function(t,i){i.is(2,6)&&"keyboard"===i.state.device&&this.jump(i.focus[0]),i.is(3,5,8)&&this.Si()},n.h=function(){var t=this,i=this.elements,n=this.elements.scroller,s=this.Editor,h=E("ryuseicode__scrollbars",i.body);V()||(this.Di=[new en(s,h,n,!0),new en(s,h,n,!1,function(){return[t.Ri(),0]})]);n=this.options.placeholder;n&&q(E("ryuseicode__placeholder",i.background),n)},n.Si=function(){var t,i,n,s,h,r,o,e,u,c,f,a=this.Caret.rect,v=this.Selection.focus;a&&this.Chunk.includes(v[0])&&(e=this.Measure,t=this.elements.scroller,i=e.padding,n=e.scrollerRect,f=e.lineHeight,u=a.top,s=a.right,h=a.bottom,r=a.left,c=j(this.elements.editor),o=t.scrollTop,e=t.scrollLeft,u<(a=n.top+f/2+i.top)&&(o-=a-u),(u=n.bottom-f/2-i.bottom)<h&&(o+=h-u),r<(c=(K()?n.left:c.left+e)+ft(i.left,f))&&(e-=c-r),(f=n.right-ft(i.right,f))<s&&(e+=s-f),v[1]||(e=0),t.scrollTop=o,t.scrollLeft=e)},n.Ri=function(){var t=this.Measure;return t.editorRect.left-t.containerRect.left},n.jump=function(t,i,n){void 0===n&&(n=1);var s=this.Measure,h=this.Chunk,r=this.Measure.scrollerRect;i?h.scroll(s.getBottom(t)-r.height/2+s.lineHeight*n):this.isVisible(t)||(n=h.start+(h.length-1)/2<t?(t=ct(t+n,this.lines.length-1),s.getBottom(t)-r.height+s.padding.top):s.getTop(ft(t-n,0)),h.scroll(n))},n.autoWidth=function(){var t=this.Measure,i=t.editorRect.width;i>t.scrollerRect.width-this.Ri()&&i>this.Ei&&(X(this.elements.lines,{minWidth:Y(i)}),this.Ei=i,this.emit(vi))},n.autoHeight=function(t){var i,n=this.lines.length;!t&&n===this.zi||(i=this.Measure,t=this.Measure.padding,i=i.lineHeight*(n||1),X(this.elements.container,{height:Y(i+t.top+t.bottom)}),this.zi=n,this.emit(li))},n.isVisible=function(t,i){void 0===i&&(i=0);var n=this.Chunk,s=this.Measure;if(n.includes(t)){n=n.getLine(t);if(n){t=s.scrollerRect,n=j(n),i=s.lineHeight*i;return n.top>=t.top+i&&n.bottom<=t.bottom-i}}return!1},n.destroy=function(){this.Di.forEach(function(t){t.destroy()}),i.prototype.destroy.call(this)},t}(t),un=Object.freeze({__proto__:null,Caret:_i,Chunk:bi,Code:Mi,ContextMenu:Hi,Edit:Bi,Input:Ii,Keymap:Wi,Measure:Ui,Range:Yi,Scope:Zi,Selection:Qi,Style:nn,Sync:Li,View:Xi}),cn={autocorrect:"off",autocapitalize:"off",spellcheck:"false",role:"textbox","aria-multiline":!0,"aria-roledescription":"editor"},fn=function(){function t(t,i,n){this.Code=t,this.lines=t.Lines,this.event=i,this.options=n}var i=t.prototype;return i.renderLines=function(t){for(var i=this.lines,n=ct(i.length,this.options.maxInitialLines),s=0;s<n;s++)t($(Rt)+i[s].html+"</div>")},i.html=function(t){function n(t){h+=t}var s=this,h="",i=this.options,r=this.options.id,i=[["root",[At,Ut].concat(i.rootClasses),{id:r,role:"code"}],["body",[Ct]],["scroller",[Mt]],["container",[Tt]],["editor",[Et]]];return i.forEach(function(t){s.event.emit(t[0]+":open",n,t[1],s.lines);var i=x({id:r+"-"+t[0]},t[2]);h+=$(t[1],i)}),h+=$([St],cn),this.renderLines(n),h+="</div>",t&&(h+='<pre class="ryuseicode__source">'+this.Code.value+"</pre>"),h+kt("</div>",i.length)},t}(),an=function(){function t(t,i,n){var s,h=this;void 0===n&&(n={}),this.Components={},this.Hi={},this.language=t,this.options=i,this.event=new Gi,this.options.id=this.options.id||(t=(xt[s=G]||0)+1,i=t<10?"0"+t:t,xt[s]=t,""+s+i),L(un,function(t,i){h.Components[i]=new t(h)}),L(n,function(t,i){var n=h.options[i.charAt(0).toLowerCase()+i.slice(1)];(v(n)||n)&&(h.Hi[i]=new t(h))})}var i=t.prototype;return i.Oi=function(){var t=this.options,i=this.event,n=this.elements;this.o(),i.emit("mount",n),L(this.Components,function(t){t.mount(n)}),L(this.Hi,function(t){t.mount(n)}),i.emit(Zt,n),this.readOnly=t.readOnly,t.autofocus&&this.focus()},i.Pi=function(){var t=this.root,i=I(t,"."+Et),n=I(t,"."+St);Ki(n,!0),A(n,{tabindex:0}),this.elements=Object.freeze({root:t,editor:i,lines:n,editable:n,body:I(t,"."+Ct),scroller:I(t,"."+Mt),container:I(t,"."+Tt),overlay:E("ryuseicode__overlay",t),background:E({class:"ryuseicode__background","aria-hidden":!0},i)})},i.o=function(){var t,i=this,n=this.elements,s=this.elements.root,h=this.event,r=this.isFocused.bind(this);this.Bi(s,"pointerdown",function(){t="pointer"}),this.Bi(n.editor,"click",function(){r()||i.focus(!0)}),this.Bi(s,"focusin",function(){r()&&!S(s,qt)&&(b(s,qt),h.emit(Kt,t))}),this.Bi(s,"focusout",tt(function(){!r()&&S(s,qt)&&(N(s,qt),h.emit(Vt),t="")},10)),h.on([Zt,ii,ni,pi],function(){it(function(){_(s,Yt,!i.value&&!i.Components.Input.composing)})})},i.Bi=function(t,i,n){P(t,i,n,this)},i.apply=function(t,i){J(!this.root,"Already initialized.");var n,s=f(t)?I(document,t):t;l(s)?(S(this.source=s,Ut)?(n=I(this.root=s,"pre"),this.Components.Code.init(q(n)||""),U(n)):(s.insertAdjacentHTML("afterend",this.html(v(i)?q(s):i,!1)),X(s,{display:"none"}),this.root=s.nextElementSibling),b(this.root,["is-initialized",V()?"is-mobile":""]),this.Pi(),this.Oi()):J(!1,t+" is invalid.")},i.html=function(t,i){var n=this.Components.Code;return n.init(t),new fn(n,this.event,this.options).html(i)},i.save=function(){var t=this.source,i=this.value;t instanceof HTMLTextAreaElement?t.value=i:q(t,i.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"))},i.focus=function(t){t?this.Components.Selection.reselect():D(this.elements.editable)},i.blur=function(){var t=m();this.isFocused()&&l(t)&&t.blur()},i.invoke=function(t,i){t=this.Hi[t];if(t&&c(t[i])){for(var n=arguments.length,s=new Array(2<n?n-2:0),h=2;h<n;h++)s[h-2]=arguments[h];return t[i].apply(t,s)}},i.require=function(t){return this.Hi[t]},i.isFocused=function(){return this.root.contains(m())},i.destroy=function(){var t=this.event;this.save(),L(x(this.Components,this.Hi),function(t){t.destroy()}),delete this.Components,delete this.Hi,X(this.source,{display:""}),U(this.elements.root),t.emit("destroyed"),t.destroy()},_createClass(t,[{key:"value",get:function(){return this.Components.Code.value},set:function(t){var i=this.Components,n=this.Components,s=n.Code,n=n.Selection;s.value=t,i.View.jump(0),i.Sync.sync(0,s.size-1),this.isFocused()?n.set([0,0]):n.update([0,0],[0,0],!0),this.event.emit(pi)}},{key:"width",get:function(){return this.root.clientWidth},set:function(t){X(this.root,{width:Y(t)}),this.Components.View.emitResize()}},{key:"height",get:function(){return this.root.clientHeight},set:function(t){X(this.root,{height:Y(t)}),this.Components.View.emitResize()}},{key:"readOnly",get:function(){return this.Fi},set:function(t){var i=this.elements;_(i.root,"is-readonly",t),Ki(i.editable,!t),this.Fi=t,this.event.emit(Gt,t)}}]),t}(),nn=function(){function s(t){this.Ii(t),this.language=s.get(this.options.language),this.Editor=new an(this.language,this.options,s.Hi)}s.register=function(t){p(t).forEach(function(i){var t=i.language,n=i.id;s.Wi[n]||(t.alias||[]).concat(n).forEach(function(t){s.Wi[t]=i})})},s.compose=function(t){L(t,function(t,i){s.Hi[i]=t})},s.get=function(t){var i=s.Wi;return J(i[t],t+" was not found."),i[t]};var t=s.prototype;return t.Ii=function(t){var n=this;this.options=x({},r),L(t,function(t,i){v(t)||(e(r[i])?e(t)&&(n.options[i]=x({},r[i],t)):n.options[i]=t)})},t.apply=function(t,i){this.Editor.apply(t,i)},t.html=function(t){return this.Editor.html(t,!0)},t.on=function(t,i){this.Editor.event.on(t,i)},t.off=function(t){this.Editor.event.off(t)},t.save=function(){this.Editor.save()},t.focus=function(t){this.Editor.focus(t)},t.setRange=function(t,i){this.Editor.Components.Selection.set(t,i)},t.toString=function(){return this.value},t.destroy=function(){this.Editor.destroy(),delete this.Editor},_createClass(s,[{key:"value",get:function(){return this.Editor.value},set:function(t){this.Editor.value=t}}]),s}();nn.Wi={},nn.Hi={};var vn={confirm:{id:"confirm",click:"confirm"},cancel:{id:"cancel",click:"hide",tabindex:0}},ln=G+"__dialog",dn=G+"-common",Li=function(i){function t(){return i.apply(this,arguments)||this}_inheritsLoose(t,i);var n=t.prototype;return n.mount=function(t){i.prototype.mount.call(this,t),this.register(dn,E(),"")},n.listen=function(){var n=this;this.bind(window,"click",function(t){n.wrapper.contains(t.target)||n.hide()}),this.on(yi,function(t,i){i("."+ln+" code","fontFamily",n.options.monospaceFont)})},n.create=function(){var t=this.elements,i=t.root.id+"-dialog";this.wrapper=E({id:i,class:ln,role:"dialog","aria-labelledby":i+"-title","aria-describedby":i+"-body"},t.overlay)},n.confirm=function(){this.emit("dialog:"+this.group+":confirmed",this),this.hide()},n.register=function(t,i,n,s){var h=(s||["confirm"]).map(function(t){return f(t)?vn[t]:t}).filter(Boolean);J(h.length);var r=this.wrapper.id,o=E("ryuseicode__dialog__group"),e=T("header","ryuseicode__dialog__header"),u=T("h3",{id:r+"-title",class:"ryuseicode__dialog__title"},e),c=T("footer","ryuseicode__dialog__footer"),s=this.createCloseButton({"aria-controls":r});A(i,{id:r+"-body",class:"ryuseicode__dialog__body"}),q(u,n),b(s,ln+"__close"),k(o,[e,i,c,s]),this.groups[t]={elm:o,title:u,body:i,buttons:this.createButtons(h,c,this)}},n.show=function(t){this.hide(),i.prototype.show.call(this,t),this.Editor.readOnly=!0,b(this.elements.overlay,jt),this.autoFocus(t),this.emit("dialog:opened",this,t)},n.hide=function(){this.isActive()&&(this.Editor.readOnly=!1,i.prototype.hide.call(this),N(this.elements.overlay,jt),this.Selection.reselect(),this.emit("dialog:closed",this,this.group))},n.message=function(t,i){var n=this.groups[dn];q(n.title,i||this.i18n.notice),q(n.body,t),this.show(dn)},t}(Di),pn={limit:100,debounce:300},yn={undo:["Z",!0,!1],redo:["Z",!0,!0]},gn="history",Xi=function(i){function t(t){t=i.call(this,t)||this;return t.ji=[],t.V=0,t.addKeyBindings(yn),t}_inheritsLoose(t,i);var n=t.prototype;return n.mount=function(t){i.prototype.mount.call(this,t),this.Ui=this.getOptions("history",pn),this.Ni=tt(this.Xi.bind(this),this.Ui.debounce),this.o()},n.o=function(){var s=this;this.on(ti,this.$i,this),this.on(ii,this.qi,this),this.on(hi+":undo "+hi+":redo",function(t,i,n){i.preventDefault(),s.Editor.readOnly||s[n]()}),this.on(pi,function(){s.ji.length=0})},n.Yi=function(){return{range:this.Selection.get(),value:this.Code.value,length:this.lines.length}},n.Zi=function(t){var i=t.range,n=t.length,s=i.start,i=i.end;this.emit(ti,gn),this.Code.value=t.value,this.Sync.sync(0,n-1,s[0]),this.Selection.set(s,i),this.emit(ii,gn),this.emit("history:restored",t)},n.Xi=function(t){var i=this.ji[this.V];i&&this.Y(i,t)||(this.ji.push(t),this.length>this.Ui.limit&&this.ji.shift(),this.V=this.length-1,this.emit("history:pushed",t),this.Ni.cancel())},n.Y=function(t,i){return t.value===i.value&&!pt(t.range.start,i.range.start)&&!pt(t.range.end,i.range.end)},n.Ki=function(){return this.V!==this.length-1},n.$i=function(t,i){var n;i!==gn&&(n=this.ji,this.Ki()&&n.splice(this.V+1,n.length),this.Selection.isCollapsed()&&this.length&&"replace"!==i||this.Xi(this.Yi()))},n.qi=function(t,i){this.Input.composing||i===gn||("input"===i?this.Ni(this.Yi()):this.Xi(this.Yi()))},n.undo=function(){this.Ni.invoke(),0<this.V&&this.V<this.length&&this.Zi(this.ji[--this.V])},n.redo=function(){this.V<this.length-1&&this.Zi(this.ji[++this.V])},_createClass(t,[{key:"length",get:function(){return this.ji.length}}]),t}(t),wn={help:!0,deepIndent:!0},mn={indentNotice:"Indent/Move Focus",indentDisabled:"Inserting indents by the Tab is currently disabled. You can toggle it by %s."},_n={indent:["Tab"],unindent:["Tab",!1,!0],toggleTabMode:["M",!0]},bn="tab-notice",Di=function(i){function n(t){t=i.call(this,t)||this;return t.addI18n(mn),t.addKeyBindings(_n),t}_inheritsLoose(n,i);var t=n.prototype;return t.mount=function(t){(this.Vi=this.require("Dialog"))&&(i.prototype.mount.call(this,t),this.Gi=this.options.indent,this.Ui=this.getOptions("indentation",wn),this.Ji="load"!==this.Ui.activation,this.rt(),this.o())},t.setDisabled=function(t){this.Ji=t,n.Qi=!0},t.o=function(){var n,s=this;this.on(Kt,function(t,i){"pointer"!==i||n||s.setDisabled(!1),n=!0}),this.on(hi+":indent "+hi+":unindent",function(t,i,n){s.Ji||("indent"===n?s.tn():s.in(),F(i))}),this.on(hi+":toggleTabMode",function(t,i){s.setDisabled(!s.Ji),F(i)}),this.on(Qt,function(){s.nn(),s.Ui.deepIndent&&s.sn()}),this.on(Jt,this.Q,this)},t.Q=function(t,i){if(this.Ui.help&&!n.Qi&&"Tab"===i.key)return this.Vi.show(bn),n.Qi=!0,void F(i);this._(i)},t.rt=function(){var t=this,i=this.i18n,n=E();z(n,_t("<p>"+i.indentDisabled+"</p>","<strong>"+this.Keymap.getShortcut("toggleTabMode")+"</strong>")),this.Vi.register(bn,n,i.indentNotice,[{id:"activate",click:function(){t.setDisabled(!1),t.Vi.hide()}},"confirm"])},t.tn=function(){var t,i=this.Input,n=this.Selection,s=this.Gi,h=this.Gi.length;n.isCollapsed()?i.apply({type:"indent",insertion:s,offset:h}):(this.emit(ti),i=(t=n.get()).start,t=t.end,this.Code.replaceLinesBy(i[0],t[0],function(t){return s+t}),this.Sync.sync(i[0],t[0]),n.set([i[0],i[1]+h],[t[0],t[1]+h]),this.emit(ii))},t.in=function(){var h,t,r=this,o=this.Gi,i=this.Selection.get(),n=i.start,s=i.end,e=0,u=0;this.Code.replaceLinesBy(n[0],s[0],function(t,i,n){var s=t.match(new RegExp("^("+o+"| {0,"+o.length+"})"));return s&&(s=s[0],t=t.replace(s,""),0===i&&(r.emit(ti),e-=s.length),i===n.length-1&&(u-=s.length),h=!0),t}),h&&(t=ft(n[1]+e,0),i=ft(s[1]+u,0),this.Sync.sync(n[0],s[0]),this.Selection.set([n[0],t],[s[0],i]),this.emit(ii))},t.nn=function(){var t=this.Input,i=this.lines[t.row].getIndent();i&&t.set("newline",{value:t.before+ki+i+t.after.replace(/^[ \t]+/,""),position:[t.row+1,i.length]})},t.sn=function(){var t,i,n,s=this.hn();-1<s&&this.rn(s)&&(t=this.Input,i=this.Gi,n=this.lines[t.row].getIndent(),s=ki+n+i+(this.en(s)?ki+n:""),t.set("indentDeep",{key:"Enter",insertion:s,position:[t.row+1,n.length+i.length]}))},t.hn=function(){for(var t=this.un(),i=0;i<t.length;i++){var n=t[i];if(c(n[0]))return n[0](this.Editor)?i:-1;var s=this.Input;if(n[0].test(s.before.trim()))return i}return-1},t.rn=function(t){t=this.un()[t],t=t&&t[2];return c(t)?t(this.Editor):!t||this.Scope.isIn(t)},t.en=function(t){var i=this.un()[t],t=i&&i[1];if(!t)return!1;if(c(t))return t(this.Editor);i=this.Input;return t.test(i.after.trim())},t._=function(t){var i,n,s,h,r,o=this.Selection;"Backspace"!==t.key||!o.isCollapsed()||(r=(h=this.lines)[n=(i=o.get().start)[0]-1])&&(s=r.getIndent(),h=h[i[0]].getIndent(),s&&s===h&&i[1]===h.length&&(this.emit(ti),r=[n,r.text.length],this.Code.replaceRange(r,i,""),this.Sync.sync(n,i[0]),o.set(r),this.emit(ii),F(t)))},t.un=function(){return this.getLanguage().indent||[]},n}(t),kn={cutLine:["X",!0],copyLine:["C",!0],moveUp:["ArrowUp",!0],moveDown:["ArrowDown",!0]},t=function(i){function t(t){t=i.call(this,t)||this;return t.addKeyBindings(kn),t}return _inheritsLoose(t,i),t.prototype.mount=function(s){i.prototype.mount.call(this,s);var n=this.Selection,h=this.Measure,r=this.Edit;this.on(hi+":copyLine",function(t,i){n.isCollapsed()&&!H(i)&&(n.selectLine(void 0,!0,!0),r.copy(),F(i))}),this.on(hi+":cutLine",function(t,i){n.isCollapsed()&&!H(i)&&(r.cutLine(),F(i))}),this.on(hi+":moveUp "+hi+":moveDown",function(t,i){var n;s.scroller.scrollTop+=(n=t.type,t="n",(n.slice(-t.length)===t?1:-1)*h.lineHeight),F(i)})},t}(t);return nn.compose({Dialog:Li,Indentation:Di,History:Xi,Shortcut:t}),nn});
//# sourceMappingURL=ryuseicode.min.js.map
